<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  

  
  <title>Rex&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="起风了，唯有努力生存 风立ちぬ,いぎ生きめやも">
<meta property="og:type" content="website">
<meta property="og:title" content="Rex&#39;s Blog">
<meta property="og:url" content="https://github.com/RoWe98/index.html">
<meta property="og:site_name" content="Rex&#39;s Blog">
<meta property="og:description" content="起风了，唯有努力生存 风立ちぬ,いぎ生きめやも">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Rex&#39;s Blog">
<meta name="twitter:description" content="起风了，唯有努力生存 风立ちぬ,いぎ生きめやも">
  
    <link rel="alternate" href="/atom.xml" title="Rex&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
  <link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Rex&#39;s Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Code and Passion</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://github.com/RoWe98"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/24/hello-world/" class="article-date">
  <time datetime="2019-12-24T13:14:52.727Z" itemprop="datePublished">2019-12-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/24/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class=" language-bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span>
</code></pre>
<p>Test Test Test!!!</p>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class=" language-bash"><code class="language-bash">$ hexo server
</code></pre>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class=" language-bash"><code class="language-bash">$ hexo generate
</code></pre>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class=" language-bash"><code class="language-bash">$ hexo deploy
</code></pre>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/RoWe98/2019/12/24/hello-world/" data-id="ck4jwhkq2000yvo4au1y0qkcv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-OpenCvCarReco" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/24/OpenCvCarReco/" class="article-date">
  <time datetime="2019-12-24T13:14:52.723Z" itemprop="datePublished">2019-12-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/24/OpenCvCarReco/">基于OpenCV技术的汽车牌照的识别</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>author: RoWe98(RexRowe)</p>
<p>OpenCV是一个基于BSD许可（开源）发行的跨平台计算机视觉库，可以运行在Linux、Windows、Android和Mac OS操作系统上。它轻量级而且高效——由一系列<br>C 函数和少量 C++ 类构成，同时提供了Python、Ruby、MATLAB等语言的接口，实现了图像处理和计算机视觉方面的很多通用算法。<br>车牌识别技术要求能够将运动中的汽车牌照从复杂背景中提取并识别出来，通过车牌提取、图像预处理、特征提取、车牌字符识别等技术，识别车辆牌号、颜色等信息，目前最新的技术水平为字母和数字的识别率可达到99.7%，汉字的识别率可达到99%。<br>车牌识别技术结合电子不停车收费系统（ETC）识别车辆，过往车辆通过道口时无须停车，即能够实现车辆身份自动识别、自动收费。在车场管理中，为提高出入口车辆通行效率，车牌识别针对无需收停车费的车辆（如月卡车、内部免费通行车辆），建设无人值守的快速通道，免取卡、不停车的出入体验，正改变出入停车场的管理模式。</p>
<h1 id="设计平台及工具"><a href="#设计平台及工具" class="headerlink" title="设计平台及工具"></a>设计平台及工具</h1><p>1.Visual Studio 2017</p>
<p>2.OpenCV2.4.9</p>
<p>3.C++</p>
<h1 id="设计原理"><a href="#设计原理" class="headerlink" title="设计原理"></a>设计原理</h1><p>车牌自动识别是一项利用车辆的动态视频或静态图像进行牌照号码、牌照颜色自动识别的模式识别技术。其硬件基础一般包括触发设备（监测车辆是否进入视野）、摄像设备、照明设备、图像采集设备、识别车牌号码的处理机（如计算机）等，其软件核心包括车牌定位算法、车牌字符分割算法和光学字符识别算法等。某些车牌识别系统还具有通过视频图像判断是否有车的功能称之为视频车辆检测。一个完整的车牌识别系统应包括车辆检测、图像采集、车牌识别等几部分(如图1所示)。当车辆检测部分检测到车辆到达时触发图像采集单元，采集当前的视频图像。车牌识别单元对图像进行处理，定位出牌照位置，再将牌照中的字符分割出来进行识别，然后组成牌照号码输出。</p>
<h1 id="主要框架："><a href="#主要框架：" class="headerlink" title="主要框架："></a>主要框架：</h1><p><img src="https://s2.ax1x.com/2019/05/14/Eo4Txg.png" alt="avatar"></p>
<h1 id="图像的预处理"><a href="#图像的预处理" class="headerlink" title="图像的预处理"></a>图像的预处理</h1><p>车牌定位的第一步为图像预处理。为了方便计算，系统通常将获取的图片灰度化。将彩色图像转化成为灰度图像的过程就称为图像的灰度化处理。彩色图像中R、G、B三个分量的值决定了具体的像素点。一个像素点可以有上千万种颜色。而灰度图像是一种彩色图像，但是它的特点在于R、G、B三个分量具体的值是一致的。灰度图中每个像素点的变化区间是0到255，由于方便计算，所以在实际工程处理中会先将各种格式的图像转变成灰度图像。在保留图像轮廓和特征的基础上，灰度图仍然能够反映整幅图像轮廓和纹理。在Opencv里面有实现图像灰度化的接口。调用OpenCV中的cvSmooth函数进行中值滤波处理，以去除细小毛刺。 </p>
<h1 id="图像二值化"><a href="#图像二值化" class="headerlink" title="图像二值化"></a>图像二值化</h1><p>局部自适应二值化是针对灰度图像中的每一个像素逐点进行阈值计算，它的阈值是由像素周围点局部灰度特性和像素灰度值来确定的。局部阈值法是逐个计算图像的每个像素灰度级，保存了图像的细节信息，非均匀光照条件等情况虽然影响整个图像的灰度分布缺不影响局部的图像性质，但也存在缺点和问题，相比全局阈值法来说，它的计算时间较长，但适用于多变的环境。<br>设图像在像素点(x,y)处的灰度值为f(x,y)，考虑以像素点(x,y)为中心的(2w+1)*(2w+1)窗口（w为窗口宽度），则局部自适应二值化算法可以描述如下：</p>
<p>a.计算图像中各点(x,y)的阈值w(x,y)</p>
<pre class=" language-bash"><code class="language-bash">W<span class="token punctuation">(</span>x,y<span class="token punctuation">)</span><span class="token operator">=</span>0.5*<span class="token punctuation">(</span>max f<span class="token punctuation">(</span>x+m,y+n<span class="token punctuation">)</span>+min f<span class="token punctuation">(</span>x+m,y+n<span class="token punctuation">))</span>
</code></pre>
<p>b.如果f(x,y)&gt;w(x,y)，则二值化结果为1，代表字符区域的目标点；否则二值化结果为0，代表背景区域的目标点。</p>
<h1 id="车牌位置的定位"><a href="#车牌位置的定位" class="headerlink" title="车牌位置的定位"></a>车牌位置的定位</h1><p>车牌细定位的目的是为下一步字符的分割做，就是要进一步去掉车牌冗余的部分。在一幅经过适当二值化处理 含有车牌的图像中，车牌区域具有以下三个基本特征：<br>列在一个不大的区域内密集包含有多个字符；<br>车牌字符与车牌底色形成强烈对比；<br>车牌区域大小相对固定，区域长度和宽度成固定比例。<br>根据以上特征，车牌区域所在行相邻像素之间0 到1和1到0 的的变化会很频繁，变化总数会大于一个临界值，这可以作为寻找车牌区域的一个依据。 因此根据跳变次数与设定的阈值比较，就可以确定出车牌的水平区域。<br>由于车牌一般悬挂在车辆下部，所以采用从上到下，从左到右的方式对图像进行扫描。车牌的字符部分由7个字符数与两个竖直边框组成，则车牌区域内任一行的跳变次数至少为(7+2)<em>2=18次。从图像的底部开始向顶部进行扫描，则第一组连续数行且每行的跳变次数都大于跳变阈值，同时满足连续行数大于某个阈值。<br>在车牌的水平区域中，最高行与最低行的差值即为车牌在图像中的高度。我国车牌区域为矩形，宽高比约为3.14，取3.14</em>H作为车牌的宽度。在水平区域内选择任意一行，用L长的窗口由左至右移动，统计窗口中相邻像素0,1的跳变次数并存入数组中。若窗口移动到车牌的垂直区域时，窗口内的跳变次数应该最大。因此在数组中找到最大值，其对应的区域即为车牌的垂直区域。</p>
<h1 id="车牌字符的识别"><a href="#车牌字符的识别" class="headerlink" title="车牌字符的识别"></a>车牌字符的识别</h1><p>车牌字符识别是字符识别的重要组成部分。车牌字符识别的最终目的就是将图像中的车牌字符转化成文本字符，车牌字符的识别属于印刷体识别范畴。<br>字符识别的基本思想是匹配判别。抽取待识别字符特征按照字符识别的原理和预先存储在计算机中的标准字符模式表达形式的集合逐一进行匹配，找出最接近输入字符模式的表达形式，该表达形式对应的字就是识别结果。</p>
<p>字符识别的原理如下：</p>
<p><img src="https://s2.ax1x.com/2019/05/14/Eo4oRS.png" alt="avatar"></p>
<p>根据我国的车牌牌照标准，车牌第一位字符一般为汉字，车牌第二位英文大写字母，第三位至第七位为英文大写字母或数字。考虑到神经网络对小类别字符集有较高的识别率，因此在车牌字符识别系统中，分别设计三个神经网络：汉字网络、字母网络、字母数字网络 实现对字符的分类识别。 </p>
<p><img src="https://s2.ax1x.com/2019/05/14/Eo4IG8.png" alt="avatar"></p>
<h1 id="程序代码"><a href="#程序代码" class="headerlink" title="程序代码"></a>程序代码</h1><p>1.OpencvCar.h 车牌识别类</p>
<p>程序</p>
<pre class=" language-c++"><code class="language-c++">#pragma once
#pragma comment (lib, "cxcore.lib")
#pragma comment (lib, "cv.lib")
#pragma comment (lib, "ml.lib")
#pragma comment (lib, "cvaux.lib")
#pragma comment (lib, "highgui.lib")
#pragma comment (lib, "cvcam.lib")
#include "cv.h"
#include "highgui.h"
#include "iostream"
#include "string"
using namespace std;
#define DEBUGTEST
#define POINT_X  18                                           // 水平方向不重点                        
#define POINT_Y  2                                            // 垂直方向不重点                            
#define WITH_X 0.1                                            // 水平方向车牌在域     
#define WITH_Y 0.2                                            // 垂直方向车牌在域     
#define HIGH_WITH_CAR   4.8   //(440/85)               // 小车的宽高比  440/140    
#define CHARACTER 15
#define TEMPLETENUM  43
class OpencvCar
{
public:
    OpencvCar();
    int CodeRecognize(IplImage *imgTest, int num, int char_num); //字符识别
    int SegmentPlate();                                //字符分割
    int PlateAreaSearch(IplImage *pImg_Image, IplImage *src);        //车牌定位
    void Threshold(IplImage *Image, IplImage *Image_O);    //二值化
    int AdaptiveThreshold(int t, IplImage *Image);        //自适应阈值法
protected:
    IplImage *src;                                // 原始图片
    IplImage *pImgCanny;                      //二值化的图
    IplImage *pImgResize;                     //归一化的车牌区域灰度图
    IplImage *pImgCharOne;                // 字符图片
    IplImage *pImgCharTwo;
    IplImage *pImgCharThree;
    IplImage *pImgCharFour;
    IplImage *pImgCharFive;
    IplImage *pImgCharSix;
    IplImage *pImgCharSeven;
};
</code></pre>
<p>2.OpencvCar.cpp 车牌识别类实现程序</p>
<p>程序</p>
<pre class=" language-c++"><code class="language-c++">#include "OpencvCar.h"

// 车牌字符模板特征值
const int Num_Templete[TEMPLETENUM][CHARACTER] =
{
    { 16, 19, 10, 12, 10, 10, 15, 18, 110, 3, 2, 2, 3, 3, 3 },     //0
    { 9, 11, 10, 10, 10, 10, 9, 10, 79, 2, 2, 2, 0, 2, 12 },       //1
    { 18, 19, 3, 18, 10, 10, 23, 22, 123, 4, 2, 2, 7, 6, 8 },      //2
    { 19, 21, 11, 14, 4, 20, 18, 22, 129, 2, 2, 4, 6, 6, 7 },      //3
    { 2, 18, 11, 22, 20, 21, 11, 18, 123, 2, 4, 2, 6, 7, 5 },      //4
    { 23, 19, 20, 12, 9, 20, 18, 22, 143, 2, 4, 4, 6, 6, 6 },      //5
    { 6, 13, 17, 8, 15, 20, 18, 20, 117, 2, 2, 4, 5, 7, 6 },       //6
    { 21, 21, 0, 20, 8, 12, 9, 11, 102, 2, 2, 2, 2, 8, 15 },       //7
    { 17, 18, 18, 19, 14, 20, 17, 20, 143, 4, 2, 4, 6, 6, 6 },     //8
    { 16, 18, 15, 21, 7, 19, 13, 7, 116, 3, 2, 2, 6, 6, 5 },       //9
    { 10, 10, 16, 16, 20, 20, 18, 19, 129, 2, 4, 2, 8, 3, 6 },     //A
    { 24, 20, 20, 19, 22, 22, 24, 20, 171, 4, 8, 4, 6, 6, 6 },     //B
    { 18, 19, 20, 4, 20, 8, 17, 21, 127, 3, 2, 4, 4, 4, 4 },       //C
    { 23, 19, 11, 20, 12, 20, 22, 21, 148, 3, 3, 3, 4, 4, 4 },     //D
    { 23, 19, 21, 9, 22, 8, 23, 23, 148, 2, 2, 2, 6, 6, 6 },       //E
    { 25, 17, 20, 9, 22, 8, 19, 0, 120, 2, 2, 2, 4, 4, 4 },        //F
    { 17, 18, 22, 14, 12, 24, 18, 21, 146, 4, 7, 4, 4, 6, 6 },     //G
    { 14, 20, 18, 22, 17, 22, 16, 20, 149, 4, 1, 4, 2, 2, 2 },     //H
    { 0, 17, 0, 20, 3, 20, 18, 22, 100, 2, 2, 4, 2, 2, 2 },        //J
    { 19, 20, 26, 10, 20, 20, 20, 22, 157, 4, 4, 4, 3, 5, 11 },    //K
    { 20, 0, 20, 0, 20, 0, 25, 20, 105, 2, 2, 2, 2, 2, 2 },        //L
    { 20, 10, 27, 17, 20, 10, 22, 14, 140, 1, 3, 3, 4, 1, 5 },     //M
    { 21, 12, 25, 17, 26, 12, 18, 18, 149, 3, 5, 3, 5, 5, 6 },     //N 
    { 23, 19, 18, 20, 21, 8, 22, 0, 131, 3, 3, 2, 4, 4, 4 },       //P
    { 18, 19, 20, 10, 26, 15, 18, 21, 147, 3, 3, 4, 5, 7, 5 },     //Q
    { 26, 19, 21, 18, 21, 17, 20, 21, 163, 4, 3, 4, 4, 6, 5 },     //R
    { 18, 18, 18, 10, 8, 17, 17, 22, 128, 4, 3, 4, 6, 6, 6 },      //S
    { 22, 18, 10, 10, 10, 10, 10, 10, 100, 2, 2, 2, 33, 2, 2 },    //T
    { 18, 12, 20, 10, 20, 10, 19, 21, 130, 3, 3, 3, 2, 2, 2 },     //U
    { 20, 19, 20, 20, 15, 14, 9, 10, 127, 4, 4, 2, 9, 1, 8 },      //V
    { 21, 25, 26, 28, 16, 16, 21, 19, 172, 6, 2, 4, 13, 0, 7 },    //W
    { 21, 21, 13, 13, 12, 11, 22, 21, 134, 4, 2, 4, 8, 0, 10 },    //X
    { 21, 20, 10, 11, 10, 10, 10, 11, 103, 3, 2, 2, 5, 2, 6 },     //Y
    { 21, 23, 5, 15, 15, 5, 24, 20, 128, 2, 2, 2, 8, 8, 7 },       //Z
    { 13, 14, 10, 10, 10, 10, 13, 13, 93, 2, 2, 2, 29, 2, 29 },    //I
    { 20, 20, 13, 20, 19, 12, 17, 20, 141, 3, 3, 4, 4, 4, 4 },     //O          //36
    { 14, 15, 17, 17, 16, 10, 25, 24, 138, 0, 2, 4, 12, 8, 9 },    //云        //37
    { 17, 20, 17, 12, 33, 28, 23, 20, 170, 3, 4, 7, 13, 6, 4 },    //苏
    { 21, 21, 23, 24, 24, 25, 31, 27, 196, 0, 9, 6, 8, 6, 7 },     //京
    { 19, 27, 20, 34, 19, 36, 24, 37, 216, 4, 4, 7, 13, 28, 3 },   //湘
    { 17, 14, 23, 27, 36, 40, 26, 27, 210, 4, 13, 4, 16, 14, 14 }, //鲁
    { 24, 24, 32, 38, 34, 32, 17, 22, 223, 9, 6, 10, 11, 12, 9 }, // 粤
    { 22, 20, 33, 37, 25, 24, 24, 25, 210, 13, 3, 6, 12, 8, 7 }     //蒙
};

//车牌字符
const char *PlateCode[TEMPLETENUM] =
{
    "0", "1", "2", "3", "4",
    "5", "6", "7", "8", "9",
    "A", "B", "C", "D", "E",
    "F", "G", "H", "J", "K",
    "L", "M", "N", "P", "Q",
    "R", "S", "T", "U", "V",
    "W", "X", "Y", "Z", "I", "O",
    "云", "苏", "京", "湘", "鲁", "粤", "蒙"
};
const char *G_PlateChar[7] = { "没", "有", "找", "到", "车", "牌", "!" }; // 车牌号
OpencvCar::OpencvCar()
{
    //初始化  变量
    IplImage *src = NULL;      //原始图片                        
    IplImage *pImgCanny = NULL;  //二值化的图                    
    IplImage *pImgResize = NULL;   //归一化的车牌区域灰度图                  
    IplImage *pImgCharOne = NULL;   //字符图片             
    IplImage *pImgCharTwo = NULL;
    IplImage *pImgCharThree = NULL;
    IplImage *pImgCharFour = NULL;
    IplImage *pImgCharFive = NULL;
    IplImage *pImgCharSix = NULL;
    IplImage *pImgCharSeven = NULL;
}
/* ----------------------自适应阈值法---------------------------------//
//--input： t：中心阈值
//--                Image: 图片指针
//-- output:  return   自适应均值的阈值
//-------------------------------------------------------------------------*/
int OpencvCar::AdaptiveThreshold(int t, IplImage *Image)
{
    int t1 = 0, t2 = 0, tnew = 0, i = 0, j = 0;
    int Allt1 = 0, Allt2 = 0, accountt1 = 0, accountt2 = 0;//Allt1 Allt2 保存两部分的和 
    for (j = 0; j < Image->height; j++) //根据现有T，将图像分为两部分，分别求两部分的平均值t1、t2
    {
        for (i = 0; i < Image->width; i++)
        {
            if (CV_IMAGE_ELEM(Image, uchar, j, i) < t)
            {
                Allt1 += CV_IMAGE_ELEM(Image, uchar, j, i);
                accountt1++;
            }
            else
            {
                Allt2 += CV_IMAGE_ELEM(Image, uchar, j, i);
                accountt2++;
            }
        }
    }
    t1 = Allt1 / accountt1;
    t2 = Allt2 / accountt2;
    tnew = 0.5*(t1 + t2);
    if (tnew == t) //若t1、t2的平均值和t相等，则阈值确定
        return tnew;
    else
        AdaptiveThreshold(tnew, Image); //不等则以t1、t2的平均值为新阈值迭代
}
/* -----------------------二值化-----------------------------------------//
// --Input：
//              IplImage *Image: 图片指针
//             int AdaptiveThreshold(int t,IplImage *Image)  //自适应阈值法
//-- Output:
//              IplImage *Image_O  二值化后的图片
//--  Description:
//              采用Canny边缘检测二值化
//-------------------------------------------------------------------------*/
void OpencvCar::Threshold(IplImage *Image, IplImage *Image_O)
{
    //得到图片的最大灰度值和最小灰度值
    int thresMax = 0, thresMin = 255, i = 0, j = 0, t = 0;
    for (j = 0; j < Image->height; j++)
        for (i = 0; i < Image->width; i++)
        {
            if (CV_IMAGE_ELEM(Image, uchar, j, i) > thresMax) //像素值 大于 255  
                thresMax = CV_IMAGE_ELEM(Image, uchar, j, i);  //把元素值赋给 thresMax
            else if (CV_IMAGE_ELEM(Image, uchar, j, i) < thresMin) //如果小于 0   
                thresMin = CV_IMAGE_ELEM(Image, uchar, j, i); //则 改变thresMin
        }
    //int T=(thresMax+thresMin)*0.5; //灰度的最大值和最小值的平均
    cvCanny(Image, Image_O, AdaptiveThreshold((thresMax + thresMin)*0.5, Image), thresMax*0.7, 3);
    //小阈值用来控制边缘连接  大阈值用来控制强边缘的初始化分割  cvCanny只接受单通道的输入
}
//车牌区域检测
/***************************************************
INPUT  : pImg_Image   二值化后的图像
src         原始图像
OUTPUT :  pImgResize  归一化后的车牌灰度图像
Description :
输出归一化图片大小 40*20
归一化的区域为在在原始图片(src) 归一化之后，在再二值化后 图
定位方法：  水平分割，垂直分割，归一化。
***********************************************************/
int OpencvCar::PlateAreaSearch(IplImage *pImg_Image, IplImage *src)
{
    if (pImg_Image == NULL) { return 0; } // 检测是否有值

    IplImage* imgTest = 0;
    int i = 0, j = 0, k = 0, m = 0;
    bool flag = 0;
    int plate_n = 0, plate_s = 0, plate_e = 0, plate_w = 0;  //关于车牌的一些变量

    int *num_h = new int[max(pImg_Image->width, pImg_Image->height)];
    if (num_h == NULL)
    {
        cout << "memory exhausted" << endl;
        //MessageBox("memory exhausted!");
        return 0;
        //    exit(1);    
    }  // end if 

    for (i = 0; i < pImg_Image->width; i++) { num_h[i] = 0; }  // 初始化 分配的空间

    imgTest = cvCreateImage(cvSize(pImg_Image->width, pImg_Image->height), IPL_DEPTH_8U, 1);
    cvCopy(pImg_Image, imgTest);

    //-- 水平 轮廓细化
    for (j = 0; j < imgTest->height; j++)
    {
        for (i = 0; i < imgTest->width - 1; i++)
        {
            CV_IMAGE_ELEM(imgTest, uchar, j, i) = CV_IMAGE_ELEM(imgTest, uchar, j, i + 1) - CV_IMAGE_ELEM(imgTest, uchar, j, i);
            num_h[j] += CV_IMAGE_ELEM(imgTest, uchar, j, i) / 250;
        }
    }


    int temp_1 = 0;
    int temp_max = 0;
    int temp_i = 0;  //说明这里for 循环 是找出数据量最大的地方  20行  也即是 车牌区域
    for (j = 0; j < imgTest->height - 20; j++)
    {
        temp_1 = 0;
        for (i = 0; i < 20; i++)//此处for循环 是为了计算20行的总数据量  
            temp_1 += num_h[i + j];
        if (temp_1 >= temp_max)
        {
            temp_max = temp_1;
            temp_i = j;//记录20行的最大数据量的开始 行
        }
    }
    k = temp_i;//以下两个while 循环是为了找出 车牌的上下边界  当一行的数据量小于某个数值时 设定此为分界行
    while (((num_h[k + 1] > POINT_X) || (num_h[k + 2] > POINT_X) || (num_h[k] > POINT_X)) && k) k--;//找出行边界行
    plate_n = k + 1;//k+2; 
    k = temp_i + 10;
    while (((num_h[k - 1] > POINT_X) || (num_h[k - 2] > POINT_X) || (num_h[k] > POINT_X)) && (k < imgTest->height)) k++; //找出下边界行
    plate_s = k;//k-2; 

    // 没找到水平分割线，设置为默认值
    if (!(plate_n && plate_s  //行为负值 或者 上行大于下行  或者 车牌宽度大于 设定值 则水平分割失败
        && (plate_n < plate_s) && ((plate_s - plate_n)*HIGH_WITH_CAR < imgTest->width*(1 - WITH_X))))
    {
        //flag=1;
        cout << "水平分割失败" << endl;
        //MessageBox("水平分割失败!");
        return 0;
    }
    else//找到水平线  
    {
        int  max_count = 0;
        int  plate_length = (imgTest->width - (plate_s - plate_n)*HIGH_WITH_CAR);
        plate_w = imgTest->width*WITH_X - 1;//车牌宽度 默认

        //--垂直方向
        for (i = 0; i < imgTest->width; i++)
            for (j = 0; j < imgTest->height - 1; j++)//用的方法是 差分赋值法——我起的名字 应该是为了细化 
            {
                CV_IMAGE_ELEM(imgTest, uchar, j, i) = CV_IMAGE_ELEM(imgTest, uchar, j + 1, i) - CV_IMAGE_ELEM(imgTest, uchar, j, i);
            }
        //下面这一段代码 相当于 拿一个车牌大小的矩形区域 从左往右 滑动，什么时候圈住的数据量最大的时候
        // 就代表找到的车牌的左边界 此时 车牌左边界的横坐标是 k
        //这里 plate_length  有点难理解，它的值是 原图像的宽度减去车牌的宽度差值。
        for (k = 0; k < plate_length; k++)
        {
            for (i = 0; i < (int)((plate_s - plate_n)*HIGH_WITH_CAR); i++)
                for (j = plate_n; j < plate_s; j++)//两水平线之间 
                {
                    num_h[k] = num_h[k] + CV_IMAGE_ELEM(imgTest, uchar, j, (i + k)) / 250;
                }
            if (num_h[k] > max_count)
            {
                max_count = num_h[k];
                plate_w = k;
            }  // end if 

        }

        CvRect ROI_rect;                 //获得图片感兴趣区域
        ROI_rect.x = plate_w;
        ROI_rect.y = plate_n;
        ROI_rect.width = (plate_s - plate_n)*HIGH_WITH_CAR;
        ROI_rect.height = plate_s - plate_n;

        if ((ROI_rect.width + ROI_rect.x) > pImg_Image->width)
        {
            ROI_rect.width = pImg_Image->width - ROI_rect.x;
            cout << "垂直方向分割失败！";
            //MessageBox("垂直方向分割失败!");
            return 0;
        }
        else
        {
            IplImage *pImg8uROI = NULL;         //感兴趣的图片
            pImg8uROI = cvCreateImage(cvSize(ROI_rect.width, ROI_rect.height), src->depth, src->nChannels);
            IplImage *pImg8u11 = NULL;        //车牌区域灰度图
            pImg8u11 = cvCreateImage(cvSize(40 * HIGH_WITH_CAR, 40), pImg8uROI->depth, pImg8uROI->nChannels);

            cvSetImageROI(src, ROI_rect);//将 ROI_rect 设置为感兴趣区域
            cvCopy(src, pImg8uROI, NULL);//把感兴趣区域 复制到 pImg8uROI
            cvResetImageROI(src);   //重新设置感兴趣区域

            pImgResize = cvCreateImage(cvSize(40 * HIGH_WITH_CAR, 40), IPL_DEPTH_8U, 1);
            cvResize(pImg8uROI, pImg8u11, CV_INTER_LINEAR); //线性插值  归一化  把车牌变成统一大小

            cvCvtColor(pImg8u11, pImgResize, CV_RGB2GRAY);  //  转为灰度图      Y=0.299*R + 0.587*G + 0.114*B
            Threshold(pImgResize, pImgResize);             // 二值化

            cvReleaseImage(&pImg8uROI);
            cvReleaseImage(&pImg8u11);
            cvReleaseImage(&imgTest);

            cvNamedWindow("车牌");
            cvShowImage("车牌", pImgResize);
        }   // end if 
    }    // end if 

    // 释放内存
    delete[]num_h;
    num_h = NULL;
    return 1;
}
//* -----------------------字符分割-----------------------------------------//
// --Input： 
//              IplImage * pImgResize ： 归一化的车牌区域灰度图   
//-- Output: 
//               IplImage *pImgCharOne              // 字符图片
//               IplImage *pImgCharTwo
//               IplImage *pImgCharThree
//               IplImage *pImgCharFour
//               IplImage *pImgCharFive
//               IplImage *pImgCharSix
//               IplImage *pImgCharSeven
//--  Description:  
//               利用垂直投影法和车牌的特征结合分割字符区域
//-------------------------------------------------------------------------*/  

int OpencvCar::SegmentPlate()
{
    if (pImgResize == NULL) { return 0; } // 没有切割成功，直接弹出

    int *num_h = new int[max(pImgResize->width, pImgResize->height)];     // 开辟空间  一般应该是 width 大小
    if (num_h == NULL)   // 
    {
        //cout<<"memory exhausted"<<endl; 
        cout << ("字符分割memory exhausted") << endl;
        return 0;
        //exit(1);    
    }  // end if 
    int i = 0, j = 0, k = 0;//循环变量 12
    int  letter[14] = { 0, 20, 23, 43, 55, 75, 78, 98, 101, 121, 124, 127, 147, 167 }; // 默认分割
    bool flag1 = 0;//    1     2     3     4       5           6    7  
    // 垂直投影
    for (i = 0; i < 40 * HIGH_WITH_CAR; i++)
    {
        num_h[i] = 0; // 初始化指针
        for (j = 0; j < 17; j++)  // 0-16 /40
        {
            num_h[i] += CV_IMAGE_ELEM(pImgResize, uchar, j, i) / 45;
        }
        for (j = 24; j < 40; j++)  // 24-39 /40
        {
            num_h[i] += CV_IMAGE_ELEM(pImgResize, uchar, j, i) / 45;
        }
    }
    // 初定位，定位点 第二个字符末端，
    int    max_count = 0;
    int   flag = 0;
    for (i = 30; i < 40 * HIGH_WITH_CAR; i++)
    {
        if (num_h[i] < POINT_Y)//小于2 
        {
            max_count++;
            if (max_count == 11)
            {
                letter[3] = i - 11; // find letter[3]//第二字符的开始位置
                while ((num_h[i] < POINT_Y) || (num_h[i - 1] < POINT_Y)) i++;
                letter[4] = i - 1; // find letter[4]  //第三个字符的开始位置
                break;//只要找到 第二个字符的末端 和 第三个字符的开始 就退出循环
            }
        }
        else
        {
            max_count = 0;
        }
    }
    // 精定位
    for (i = 0; i < 40 * HIGH_WITH_CAR; i++)//每一列的 
    {
        for (j = 17; j <= 24; j++)  // 17-24 /40   每一列的17 到 24 行相加 
        {
            num_h[i] += CV_IMAGE_ELEM(pImgResize, uchar, j, i) / 45;
        }
    }

    for (j = letter[3]; j > 0; j--)//从第二个字符的末端开始 往前找第一个和第二个字符起始位置
    {
        if ((num_h[j] < POINT_Y) && (num_h[j - 1] < POINT_Y))//只要有两个列的 17到24 行的值小于 2，
        {                                           //即找到第二个字符的开始位置
            letter[2] = j;      // find letter[2]  第二个字符的开始位置
            letter[1] = (j >= 23) ? j - 3 : letter[1];   //第一个字符的结束位置
            letter[0] = (j >= 23) ? j - 23 : letter[0];  //第一个字符的起始位置
            break;       //找到就退出循环
        }
    }

    j = 2;  flag = 0; flag1 = 0;//两个标记
    for (i = letter[4]; i < 40 * HIGH_WITH_CAR; i++)  //从第三个字符的开始位置算起
    {
        if ((num_h[i] > POINT_Y) && (num_h[i - 1] > POINT_Y) && !flag)
        {
            flag = 1;
            flag1 = 0;
            letter[2 * j] = i - 1; //这里 只记录字符的开始位置
            if (j == 6)  //判断 最后一个字符的结束位置 是否越界 超出界限,如果没有,则letter[13]=letter[12]+20
            {
                letter[2 * j + 1] = ((letter[2 * j] + 20) > 40 * HIGH_WITH_CAR - 1) ? 40 * HIGH_WITH_CAR - 1 : letter[2 * j] + 20;
                break;//退出 for循环
            }
        }
        else if ((num_h[i] < POINT_Y) && (num_h[i - 1] < POINT_Y) && !flag1 && flag)//如果是 空白区域  
        {
            flag = 0;
            flag1 = 1;
            letter[2 * j + 1] = i - 1;
            j++; //j自动加 1
        }                        //    1    
    }
    // 删除角点                              1   0   1
    for (i = 0; i < 40 * HIGH_WITH_CAR - 1; i++)
    {                                   //      1    删除角点  相当于拿一个半径为1 的圆 去圈 如果四周有两个是1  则自己设置为0   

        for (j = 0; j < 39; j++)  // 0-16 /40
        {

            if (CV_IMAGE_ELEM(pImgResize, uchar, j, i) && CV_IMAGE_ELEM(pImgResize, uchar, j, i + 1) && CV_IMAGE_ELEM(pImgResize, uchar, j + 1, i)) //  01
                CV_IMAGE_ELEM(pImgResize, uchar, j, i) = 0;                                                                                                                                                                                                                             //   1

            if (CV_IMAGE_ELEM(pImgResize, uchar, j, i) && CV_IMAGE_ELEM(pImgResize, uchar, j, i - 1) && CV_IMAGE_ELEM(pImgResize, uchar, j + 1, i))     //  10
                CV_IMAGE_ELEM(pImgResize, uchar, j, i) = 0;                                                                                                                                                                                                                               //    1                      

            if (CV_IMAGE_ELEM(pImgResize, uchar, j, i) && CV_IMAGE_ELEM(pImgResize, uchar, j, i - 1) && CV_IMAGE_ELEM(pImgResize, uchar, j - 1, i))         //   1      
                CV_IMAGE_ELEM(pImgResize, uchar, j, i) = 0;                                                                                    // 10
            if (CV_IMAGE_ELEM(pImgResize, uchar, j, i) && CV_IMAGE_ELEM(pImgResize, uchar, j, i + 1) && CV_IMAGE_ELEM(pImgResize, uchar, j - 1, i))           // 1      
                CV_IMAGE_ELEM(pImgResize, uchar, j, i) = 0;                                                                                 // 01
        }
    }

    // 分割出字符图片
    pImgCharOne = cvCreateImage(cvSize(20, 40), IPL_DEPTH_8U, 1);
    pImgCharTwo = cvCreateImage(cvSize(20, 40), IPL_DEPTH_8U, 1);
    pImgCharThree = cvCreateImage(cvSize(20, 40), IPL_DEPTH_8U, 1);
    pImgCharFour = cvCreateImage(cvSize(20, 40), IPL_DEPTH_8U, 1);
    pImgCharFive = cvCreateImage(cvSize(20, 40), IPL_DEPTH_8U, 1);
    pImgCharSix = cvCreateImage(cvSize(20, 40), IPL_DEPTH_8U, 1);
    pImgCharSeven = cvCreateImage(cvSize(20, 40), IPL_DEPTH_8U, 1);

    CvRect ROI_rect1;
    ROI_rect1.x = 0.5*(letter[1] + letter[0]) - 10; //
    ROI_rect1.y = 0;
    ROI_rect1.width = 20;
    ROI_rect1.height = 40;
    cvSetImageROI(pImgResize, ROI_rect1);
    cvCopy(pImgResize, pImgCharOne, NULL); //获取第1个字符
    cvResetImageROI(pImgResize);
    cvNamedWindow("第一个字符");
    cvShowImage("第一个字符", pImgCharOne);

    ROI_rect1.x = 0.5*(letter[3] + letter[2]) - 10;
    ROI_rect1.y = 0;
    ROI_rect1.width = 20;
    ROI_rect1.height = 40;
    cvSetImageROI(pImgResize, ROI_rect1);
    cvCopy(pImgResize, pImgCharTwo, NULL); //获取第2个字符
    cvResetImageROI(pImgResize);
    cvNamedWindow("第二个字符");
    cvShowImage("第二个字符", pImgCharTwo);

    ROI_rect1.x = 0.5*(letter[5] + letter[4]) - 10;
    ROI_rect1.y = 0;
    ROI_rect1.width = 20;
    ROI_rect1.height = 40;
    cvSetImageROI(pImgResize, ROI_rect1);
    cvCopy(pImgResize, pImgCharThree, NULL); //获取第3个字符
    cvResetImageROI(pImgResize);
    cvNamedWindow("第三个字符");
    cvShowImage("第三个字符", pImgCharThree);

    ROI_rect1.x = 0.5*(letter[7] + letter[6]) - 10;
    ROI_rect1.y = 0;
    ROI_rect1.width = 20;
    ROI_rect1.height = 40;
    cvSetImageROI(pImgResize, ROI_rect1);
    cvCopy(pImgResize, pImgCharFour, NULL); //获取第4个字符
    cvResetImageROI(pImgResize);
    cvNamedWindow("第四个字符");
    cvShowImage("第四个字符", pImgCharFour);

    ROI_rect1.x = 0.5*(letter[9] + letter[8]) - 10;
    ROI_rect1.y = 0;
    ROI_rect1.width = 20;
    ROI_rect1.height = 40;
    cvSetImageROI(pImgResize, ROI_rect1);
    cvCopy(pImgResize, pImgCharFive, NULL); //获取第5个字符
    cvResetImageROI(pImgResize);
    cvNamedWindow("第五个字符");
    cvShowImage("第五个字符", pImgCharFive);

    ROI_rect1.x = 0.5*(letter[11] + letter[10]) - 10;
    ROI_rect1.y = 0;
    ROI_rect1.width = 20;
    ROI_rect1.height = 40;
    cvSetImageROI(pImgResize, ROI_rect1);
    cvCopy(pImgResize, pImgCharSix, NULL); //获取第6个字符
    cvResetImageROI(pImgResize);
    cvNamedWindow("第六个字符");
    cvShowImage("第六个字符", pImgCharSix);

    ROI_rect1.x = 0.5*(letter[13] + letter[12]) - 10;
    ROI_rect1.y = 0;
    ROI_rect1.width = 20;
    ROI_rect1.height = 40;
    cvSetImageROI(pImgResize, ROI_rect1);
    cvCopy(pImgResize, pImgCharSeven, NULL); //获取第7个字符
    cvResetImageROI(pImgResize);
    cvNamedWindow("第七个字符");
    cvShowImage("第七个字符", pImgCharSeven);


    //字符识别
    CodeRecognize(pImgCharOne, 3, 0);
    CodeRecognize(pImgCharTwo, 1, 1);
    CodeRecognize(pImgCharThree, 2, 2);
    CodeRecognize(pImgCharFour, 2, 3);
    CodeRecognize(pImgCharFive, 0, 4);
    CodeRecognize(pImgCharSix, 0, 5);
    CodeRecognize(pImgCharSeven, 0, 6);

    //输出字符在控制台上
    string outFile = "";
    int carnum;
    for (carnum = 0; carnum < 7; carnum++)
    {
        outFile += G_PlateChar[carnum];
    }

    cout << "车牌为:";
    cout << outFile << endl;

    cvWaitKey();

    // 释放内存
    delete[]num_h;
    num_h = NULL;

}
//* -----------------------字符识别-----------------------------------------//
// --Input： 
//               IplImage *pImgCharOne              // 字符图片
//               IplImage *pImgCharTwo
//               IplImage *pImgCharThree
//               IplImage *pImgCharFour
//               IplImage *pImgCharFive
//               IplImage *pImgCharSix
//               IplImage *pImgCharSeven
//               int num                    // 数字字符汉字识别用，
//                                          // 0 数字 1英文 2英文和数字 3中文
//               int char_num               // 第char_num个车牌字符
//-- Output:   
//               char *G_G_PlateChar[7]      // 车牌号 
//--  Description:  
//               利用垂直投影法和车牌的特征结合分割字符区域
//-------------------------------------------------------------------------*/  

//说明：垂直投影 
//对于二值图像，水平方向的投影就是每行的非零像素值的个数，在这里就是1或者255，
//垂直投影就是每列图像数据中非零像素值的个数。
//车牌特征  就是 车牌一般大小  即长宽比例，还有每个字符之间的间隔 第二个和第三个字符之间间
//隔大些，车牌里有汉字、数字和字母，第一个是汉字，第二个是字母，后面是字母和数字，大体也就这么些特征
int OpencvCar::CodeRecognize(IplImage *imgTest, int num, int char_num)
{
    if (imgTest == NULL) { return 0; }

    int i = 0, j = 0, k = 0, t = 0;//循环变量
    int  char_start = 0, char_end = 0;//*PlateCode[TEMPLETENUM] 车牌字符里字母、数字、汉字起始位置
    int num_t[CHARACTER] = { 0 };
    switch (num)//这里这样分 可以提高效率，并且提高了识别率
    {
    case 0:  char_start = 0;         // 数字
        char_end = 9;
        break;
    case 1:  char_start = 10;        // 英文
        char_end = 35;
        break;
    case 2:  char_start = 0;       // 英文和数字
        char_end = 35;
        break;
    case 3:  char_start = 36;       // 中文
        char_end = TEMPLETENUM - 1;
        break;
    default: break;
    }
    // 提取前8个特征  前8个特征 可以说是固定位置的值  固定算法
    for (k = 0; k < 8; k++)
    {
        for (j = int(k / 2) * 10; j<int(k / 2 + 1) * 10; j++)
        {
            for (i = (k % 2) * 10; i < (k % 2 + 1) * 10; i++)
            {
                num_t[k] += CV_IMAGE_ELEM(imgTest, uchar, j, i) / 255;
            }
        }
        num_t[8] += num_t[k];  // 第9个特征 前8个特征的和作为第9个特征值
    }

    for (i = 0; i < 20; i++)  //以下特征也是 固定算法得到的 
        num_t[9] += CV_IMAGE_ELEM(imgTest, uchar, 10, i) / 255;
    for (i = 0; i < 20; i++)
        num_t[10] += CV_IMAGE_ELEM(imgTest, uchar, 20, i) / 255;
    for (i = 0; i < 20; i++)
        num_t[11] += CV_IMAGE_ELEM(imgTest, uchar, 30, i) / 255;

    for (j = 0; j < 40; j++)
        num_t[12] += CV_IMAGE_ELEM(imgTest, uchar, j, 7) / 255;
    for (j = 0; j < 40; j++)
        num_t[13] += CV_IMAGE_ELEM(imgTest, uchar, j, 10) / 255;
    for (j = 0; j < 40; j++)
        num_t[14] += CV_IMAGE_ELEM(imgTest, uchar, j, 13) / 255;
    //输出匹配字符的特征值
    cout << "第" << char_num+1 << "个字符的特征值为:  ";
    for (int carnum = 0; carnum < 15; carnum++)
    {
        cout << num_t[carnum] << " ";
    }

    int num_tt[CHARACTER] = { 0 };
    int matchnum = 0;  //可以说是 匹配度或 相似度
    int matchnum_max = 0;
    int matchcode = 0;         // 匹配号
    //int matchtempnum[10]={0};
    j = 0;
    for (k = char_start; k <= char_end; k++)
        //for(k=40;k<42;k++)
    {
        matchnum = 0;

        for (i = 0; i < 8; i++) //区域的匹配
        {
            //    num_tt[i]= abs(num_t[i]-num[k][i]);      
            if (abs(num_t[i] - Num_Templete[k][i]) <= 2)//与模板里的相应值进行匹配
                matchnum++;//两者相减，如果绝对值小于2，标记匹配成功一次
        }

        if (Num_Templete[k][i] - abs(num_t[i]) <= 8)//对第9个特征进行匹配 
            matchnum += 2;
        for (i = 9; i < CHARACTER; i++)  // 横竖的匹配  
        {
            if (Num_Templete[k][i] >= 5)  //特征值 大于5 
            {
                if (abs(num_t[i] - Num_Templete[k][i]) <= 1)
                    matchnum += 2;
            }
            else if (num_t[i] == Num_Templete[k][i])
            {
                matchnum += 2;
            }
        }
        if (matchnum > matchnum_max)
        {
            matchnum_max = matchnum;  //保留最大的 匹配 
            matchcode = k;  //记录 识别的字符的 索引 
            //matchtempnum[j]=matchnum_min
        }
    }
    //识别输出  存放输出结果
    G_PlateChar[char_num] = PlateCode[matchcode]; //保存下该字符
    cout << "    匹配成功，匹配字符为: " << G_PlateChar[char_num] << endl;
}
</code></pre>
<p>3.CarReco.cpp 车牌识别主程序</p>
<p>程序</p>
<pre class=" language-c++"><code class="language-c++">#include "OpencvCar.h"
using namespace std;
int main()
{
    IplImage *src;   //原始图片                        
    IplImage *pImgCanny; //二值化的图   
    IplImage *pImgResize;  //归一化的车牌区域灰度图                  
    IplImage *pImgCharOne;  //字符图片             
    IplImage *pImgCharTwo;
    IplImage *pImgCharThree;
    IplImage *pImgCharFour;
    IplImage *pImgCharFive;
    IplImage *pImgCharSix;
    IplImage *pImgCharSeven;
    //实例化OpencvCar类 
    OpencvCar cvCar;
    cout << "欢迎使用车牌识别系统" << endl;
    src = NULL;
    const char *filepath;
    filepath = "car3.jpg";  //等待识别的图片位置
    src = cvLoadImage(filepath); //读取图片
    cvNamedWindow("原图像");
    cvShowImage("原图像", src);
    pImgCanny = cvCreateImage(cvSize(src->width, src->height), IPL_DEPTH_8U, 1);     //  2值化后图片大小初始化
    cvCvtColor(src, pImgCanny, CV_RGB2GRAY);  //转化为灰度图  openCV函数 Y = 0.299*R + 0.587*G + 0.114*B   //  转为灰度图      Y=0.299*R + 0.587*G + 0.114*B
    cvSmooth(pImgCanny, pImgCanny, CV_GAUSSIAN, 3, 0, 0); 
    //二值化
    cvCar.Threshold(pImgCanny, pImgCanny);
    cvNamedWindow("二值化图像");
    cvShowImage("二值化图像", pImgCanny);
    //车牌定位
    cvCar.PlateAreaSearch(pImgCanny, src);
    //字符分割并识别
    cvCar.SegmentPlate();
    return 0;
}
</code></pre>
<p>#运行效果</p>
<p><img src="https://s2.ax1x.com/2019/05/14/EoIAXQ.md.png" alt="效果"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/RoWe98/2019/12/24/OpenCvCarReco/" data-id="ck4jwhkpt000lvo4a7a4cfs5z" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-How-to-make-A-image-Server" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/24/How-to-make-A-image-Server/" class="article-date">
  <time datetime="2019-12-24T13:14:52.722Z" itemprop="datePublished">2019-12-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/24/How-to-make-A-image-Server/">如何搭建一个图片服务器</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>author: RoWe98(RexRowe)</p>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言:"></a>前言:</h1><p>在分布式架构中，往往会有多个tomcat，然后你上传的图片只是在其中的某一个tomcat，你访问时是由集群的tomcat随机提供服务。当你访问的tomcat是有图片的那个时，图片能正常显示，如果恰巧是那个没有图片的tomcat时，图片就不能正常显示。这就完成了访问同一个图片，可能你刷新一次可以访问，再刷新一次图片就访问不到了。这时，我们就需要一个服务器用来专门存储图片，一般我们都用nginx。</p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介:"></a>简介:</h1><p>1、nginx:</p>
<p>Nginx是一款轻量级的Web 服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器，并在一个BSD-like 协议下发行。其特点是占有内存少，并发能力强，事实上nginx的并发能力确实在同类型的网页服务器中表现较好，中国大陆使用nginx网站用户有：百度、京东、新浪、网易、腾讯、淘宝等。以上是百度百科的介绍，我们目前只需要知道nginx是一个服务器就行了，类似于tomcat的服务器，只不过我们把它用来保存图片。<br>2、vsftp:</p>
<p>VSFTP是一个基于GPL发布的类Unix系统上使用的FTP服务器软件，它有安全、高速、稳定等特点。我们暂且这样理解:vsftp就是用来传输文件的一个服务，在linux系统中开启vsftp服务，然后在windows中就可以通过linux系统的ip、vsftp服务的端口、vsftp的用户名及密码连接vsftp服务，然后就可以方便的把windows中东西上传到linux中，也可以把linux中的东西下载到windows中。<br>3、nginx+vsftp:</p>
<p>上面分别介绍了nginx和vsftp，那么这两个东西怎么组合起来用呢？怎么实现这个图片服务器呢？我们知道，tomcat安装好启动后，在浏览器输入localhost:8080，就会出现tomcat的欢迎页，nginx也一样。比如linux的ip是192.168.50.122，那么启动nginx后，在浏览器访问这个地址也会出现nginx的欢迎页，其实是因为它有个默认的访问页面，完整的地址应该是192.168.50.122/index.html，那么我们就可以根据这个，把它默认的访问页面改成我们上传的图片的保存路径，比如上传了一张pic.jpg图片到linux的/home/ftpuser/images中，如果我们把默认访问页面改成/home/ftpuser，那么在浏览器中输入192.168.50.122/images/pic.jpg，就可以访问到这张图片了。下面就来介绍nginx、vsftp的安装以及配置。</p>
<h1 id="Nginx安装"><a href="#Nginx安装" class="headerlink" title="Nginx安装"></a>Nginx安装</h1><p>依赖环境安装</p>
<pre class=" language-bash"><code class="language-bash">yum <span class="token function">install</span> gcc

yum <span class="token function">install</span> pcre-devel

yum <span class="token function">install</span> zlib zlib-devel

yum <span class="token function">install</span> openssl openssl-devel
</code></pre>
<p>开启防火墙端口：</p>
<p>Centos7默认防火墙是firewalld,一下是相关命令</p>
<pre class=" language-bash"><code class="language-bash"><span class="token comment" spellcheck="true">#service firewalld status; #查看防火墙状态</span>
<span class="token comment" spellcheck="true">#service firewalld start;  或者 #systemctl start firewalld.service;</span>
<span class="token comment" spellcheck="true">#开启防火墙# service firewalld stop;  或者 #systemctl stop firewalld.service;</span>
<span class="token comment" spellcheck="true">#关闭防火墙# service firewalld restart;  或者 #systemctl restart firewalld.service;  </span>
<span class="token comment" spellcheck="true">#重启防火墙# systemctl disable firewalld.service</span>
<span class="token comment" spellcheck="true">#禁止防火墙开启自启# systemctl enable firewalld</span>
<span class="token comment" spellcheck="true">#设置防火墙开机启动# yum remove firewalld</span>
<span class="token comment" spellcheck="true">#卸载firewall# firewall-cmd --query-port=80/tcp  #查询端口号80 是否开启</span>
</code></pre>
<p>先把nginx和vsftp相关端口开启，分别执行一下5条指令即可。</p>
<pre class=" language-bash"><code class="language-bash">firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>80/tcp --permanent
firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>443/tcp --permanent
firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>22/tcp --permanent
firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>21/tcp --permanent
firewall-cmd --zone<span class="token operator">=</span>public --add-port<span class="token operator">=</span>30000-30999/tcp --permanent
</code></pre>
<p>①、下载:</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">wget</span> -c https://nginx.org/download/nginx-1.10.1.tar.gz
</code></pre>
<p>②、解压:</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">tar</span> -zxvf nginx-1.10.1.tar.gz
<span class="token function">cd</span> nginx-1.10.1
</code></pre>
<p>③、设置编译参数:</p>
<pre class=" language-bash"><code class="language-bash">./configure \
--prefix<span class="token operator">=</span>/usr/local/nginx \
--pid-path<span class="token operator">=</span>/var/run/nginx/nginx.pid \
--lock-path<span class="token operator">=</span>/var/lock/nginx.lock \
--error-log-path<span class="token operator">=</span>/var/log/nginx/error.log \
--http-log-path<span class="token operator">=</span>/var/log/nginx/access.log \
--with-http_gzip_static_module \
--http-client-body-temp-path<span class="token operator">=</span>/var/temp/nginx/client \
--http-proxy-temp-path<span class="token operator">=</span>/var/temp/nginx/proxy \
--http-fastcgi-temp-path<span class="token operator">=</span>/var/temp/nginx/fastcgi \
--http-uwsgi-temp-path<span class="token operator">=</span>/var/temp/nginx/uwsgi \
--http-scgi-temp-path<span class="token operator">=</span>/var/temp/nginx/scgi
</code></pre>
<p>直接把这段代码贴到linux中执行就行了。</p>
<p>④、编译安装:</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">make</span> <span class="token operator">&amp;&amp;</span> <span class="token function">make</span> <span class="token function">install</span>
</code></pre>
<p>⑤、启动:</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span> /usr/local/nginx/sbin
./nginx
</code></pre>
<p>⑥、关闭nginx:<br>在刚才的sbin目录下执行:</p>
<pre class=" language-bash"><code class="language-bash">./nginx -s stop
</code></pre>
<p>遇到的坑:</p>
<p>第一次启动nginx没问题，如果重启了一下虚拟机，再次到nginx的sbin目录下执行./nginx，出现下图所示的错误:</p>
<p><img src="https://s2.ax1x.com/2019/05/14/Eo4muj.png" alt="avatar"></p>
<p>解决办法:<br>在run文件夹下创建一个nginx文件夹即可。</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">cd</span> /var/run
<span class="token function">mkdir</span> nginx

</code></pre>
<p>然后再运行就可以了</p>
<p>#vsftp的安装:</p>
<p>1、安装:</p>
<pre><code>yum -y install vsftpd
</code></pre><p>2、添加ftp用户:</p>
<pre><code>useradd ftpuser
</code></pre><p>3、给ftp用户添加密码:</p>
<pre><code>passwd ftpuser
</code></pre><p>输入两次密码后修改密码。<br>4、修改selinux:<br>①查看状态:</p>
<pre><code>getsebool -a | grep ftp
</code></pre><p>执行这个命令可以看到</p>
<pre><code>allow_ftpd_full_access --&gt; off
ftp_home_dir --&gt; off
</code></pre><p>这两个都off，执行如下命令设置为on:</p>
<pre><code>[root@localhost ~]# setsebool -P ftpd_full_access on
[root@localhost ~]# setsebool -P ftp_home_dir on
</code></pre><p>再次执行getsebool -a | grep ftp看到那两个状态是on就行了。<br>5、关闭匿名访问:<br>执行</p>
<pre><code>vim /etc/vsftpd/vsftpd.conf
</code></pre><p><img src="https://s2.ax1x.com/2019/05/14/Eo4nDs.png" alt="avatar"></p>
<p>还要在vsftp.conf文件最下面添加以下内容:</p>
<pre class=" language-bash"><code class="language-bash">pasv_min_port<span class="token operator">=</span>30000
pasv_max_port<span class="token operator">=</span>30999
</code></pre>
<p>然后保存退出即可。</p>
<p>6、设置开机启动:</p>
<pre><code>[root@localhost ~]# chkconfig vsftpd on
</code></pre><p>7、测试:<br>打开filezilla工具，输入虚拟机的ip，21端口，用户名和密码，点击快速连接，连接vsftp服务:</p>
<p><img src="https://s2.ax1x.com/2019/05/14/Eo4MEq.jpg" alt="avatar"></p>
<p>如图所示则连接成功。</p>
<p>#配置nginx为图片服务器:<br>按照以上步骤安装好nginx和vsftp后，还是不能访问上传的图片的，需要进行如下配置:<br>执行</p>
<pre><code>vim  /usr/local/nginx/conf/ nginx.conf
</code></pre><p>命令，打开nginx的配置文件:<br><img src="https://s2.ax1x.com/2019/05/14/Eo4ZvQ.png" alt="avatar"></p>
<p>按道理这样就可以了，但是我访问却报错:<br>403 forbidden，最后发现是因为ftpuser文件夹没有可读权限，执行如下命令:</p>
<pre><code>chmod -R 755 /home/ftpuser
</code></pre><p>再次访问即可成功！</p>
<p><img src="https://s2.ax1x.com/2019/05/14/Eo4E8S.png" alt="avatar"></p>
<p><img src="https://s2.ax1x.com/2019/05/14/Eo4ubn.png" alt="avatar"></p>
<h1 id="END"><a href="#END" class="headerlink" title="END"></a>END</h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/RoWe98/2019/12/24/How-to-make-A-image-Server/" data-id="ck4jwhkpd0006vo4adzdjhkv3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-JavaSocket" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/24/JavaSocket/" class="article-date">
  <time datetime="2019-12-24T13:14:52.722Z" itemprop="datePublished">2019-12-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/24/JavaSocket/">利用Socket编程(TCP协议)完成聊天室</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>author: RoWe98(RexRowe)</p>
<h1 id="利用Socket编程-TCP协议-完成聊天室"><a href="#利用Socket编程-TCP协议-完成聊天室" class="headerlink" title="利用Socket编程(TCP协议)完成聊天室"></a>利用Socket编程(TCP协议)完成聊天室</h1><h1 id="摘-要"><a href="#摘-要" class="headerlink" title="摘 要"></a>摘 要</h1><p>使用基于TCP协议的Socket网络编程实现聊天室,TCP协议基于hex请求(Request)-响应(Response)模式,使用IO流实现数据的传输</p>
<h1 id="二、设计平台"><a href="#二、设计平台" class="headerlink" title="二、设计平台"></a>二、设计平台</h1><p>JAVA Socket编程 </p>
<h1 id="三、设计原理"><a href="#三、设计原理" class="headerlink" title="三、设计原理"></a>三、设计原理</h1><p>TCP模型</p>
<p><img src="https://s2.ax1x.com/2019/05/14/Eo5PsJ.png" alt="avatar"></p>
<p>C/S 模型<br>下图是基于TCP协议的客户端/服务器程序的一般流程：</p>
<p><img src="https://s2.ax1x.com/2019/05/14/Eo5CM4.png" alt="avatar"></p>
<p>服务器调用socket()、bind()、listen()完成初始化后，调用accept()阻塞等待，处于监听端口的状态，客户端调用socket()初始化后，调用connect()发出SYN段并阻塞等待服务器应答，服务器应答一个SYN-ACK段，客户端收到后从connect()返回，同时应答一个ACK段，服务器收到后从accept()返回。<br>数据传输的过程：<br>建立连接后，TCP协议提供全双工的通信服务，但是一般的客户端/服务器程序的流程是由客户端主动发起请求，服务器被动处理请求，一问一答的方式。因此，服务器从accept()返回后立刻调用read()，读socket就像读管道一样，如果没有数据到达就阻塞等待，这时客户端调用write()发送请求给服务器，服务器收到后从read()返回，对客户端的请求进行处理，在此期间客户端调用read()阻塞等待服务器的应答，服务器调用write()将处理结果发回给客户端，再次调用read()阻塞等待下一条请求，客户端收到后从read()返回，发送下一条请求，如此循环下去。<br>如果客户端没有更多的请求了，就调用close()关闭连接，就像写端关闭的管道一样，服务器的read()返回0，这样服务器就知道客户端关闭了连接，也调用close()关闭连接。注意，任何一方调用close()后，连接的两个传输方向都关闭，不能再发送数据了。如果一方调用shutdown()则连接处于半关闭状态，仍可接收对方发来的数据。<br>在学习socket API时要注意应用程序和TCP协议层是如何交互的：应用程序调用某个socket函数时TCP协议层完成什么动作，比如调用connect()会发出SYN段应用程序如何知道TCP协议层的状态变化，比如从某个阻塞的socket函数返回就表明TCP协议收到了某些段，再比如read()返回0就表明收到了FIN段</p>
<p>利用Java的Socket类</p>
<p>ServerSocket 类的构造方法：</p>
<pre class=" language-bash"><code class="language-bash">ServerSocket<span class="token punctuation">(</span><span class="token punctuation">)</span> 创建未绑定的服务器套接字
ServerSocket<span class="token punctuation">(</span>int port<span class="token punctuation">)</span> 创建绑定到指定端口的服务器套接字 
ServerSocket<span class="token punctuation">(</span>int port，int backlog<span class="token punctuation">)</span> 创建服务器套接字并将其绑定到指定的本地端口    号，并指定了积压。 
ServerSocket<span class="token punctuation">(</span>int port，int backlog，InetAddress bindAddr<span class="token punctuation">)</span> 创建一个具有指定端口    的服务器，侦听backlog和本地IP地址绑定。 
</code></pre>
<p>Socket类的构造方法:</p>
<pre class=" language-bash"><code class="language-bash">Socket<span class="token punctuation">(</span><span class="token punctuation">)</span> 创建一个未连接的套接字，并使用系统默认类型的SocketImpl。
Socket<span class="token punctuation">(</span>InetAddress address, int port<span class="token punctuation">)</span> 创建流套接字并将其连接到指定IP地址的指定    端口号。
Socket<span class="token punctuation">(</span>InetAddress address, int port, InetAddress localAddr, int localPort<span class="token punctuation">)</span> 创建套接    字并将其连接到指定的远程端口上指定的远程地址。
Socket<span class="token punctuation">(</span>Proxy proxy<span class="token punctuation">)</span> 创建一个未连接的套接字，指定应该使用的代理类型（如果有    的话），无论其他任何设置如何。
Socket<span class="token punctuation">(</span>SocketImpl impl<span class="token punctuation">)</span> 使用用户指定的SocketImpl创建一个未连接的Socket
Socket<span class="token punctuation">(</span>String host, int port<span class="token punctuation">)</span> 创建流套接字并将其连接到指定主机上的指定端口号。
Socket<span class="token punctuation">(</span>String host, int port, InetAddress localAddr, int localPort<span class="token punctuation">)</span>创建套接字并将其    连接到指定远程端口上的指定远程主机。 
</code></pre>
<p>Socket通信的基本原理：</p>
<p><img src="https://s2.ax1x.com/2019/05/14/Eo5pzF.png" alt="avatar"></p>
<p>思路：客户端使用Socket类新建一个Client对象，服务端使用ServerSocket类新建一个Server对象，使用IO流完成数据的传输和交互，客户端的输出流为服务端的输入流；服务端的输出流为客户端的输入流。</p>
<p>Socket编程使用TCP协议的基本步骤：</p>
<pre class=" language-bash"><code class="language-bash">服务器创建ServerSocket，在指定端口监听并处理请求
客户端创建socket，向服务器发送请求
</code></pre>
<p><img src="https://s2.ax1x.com/2019/05/14/Eo5SRU.png" alt="avatar"></p>
<h1 id="四、程序主要流程图"><a href="#四、程序主要流程图" class="headerlink" title="四、程序主要流程图"></a>四、程序主要流程图</h1><p><br>服务器端(Server)</p>
<p><img src="https://s2.ax1x.com/2019/05/14/Eo4xiV.png" alt="avatar"></p>
<p>客户端(Client)</p>
<p><img src="https://s2.ax1x.com/2019/05/14/Eo5iL9.png" alt="avatar"></p>
<h1 id="五、程序代码"><a href="#五、程序代码" class="headerlink" title="五、程序代码"></a>五、程序代码</h1><p>服务端(ChatServer.java)</p>
<p>1.新建一个ChatServer类完成服务端的编写</p>
<p>2.指定端口使用SocketServer创建服务器，阻塞式等待连接accept</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> IOException <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----Server-----"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 1、指定端口 使用ServerSocket创建服务器</span>
        ServerSocket server <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8889</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 2、阻塞式等待连接 accept</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                Socket  client <span class="token operator">=</span>server<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"一个客户端建立了连接"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                Channel c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Channel</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>
                all<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//使用容器管理所有成员客户端</span>
                <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            
            <span class="token punctuation">}</span>        
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>3.使用CopyOnWriteArrayList创建容器all从而管理所有的客户端成员</p>
<pre class=" language-java"><code class="language-java">Private <span class="token keyword">static</span> CopyOnWriteArrayList<span class="token operator">&lt;</span>Channel<span class="token operator">></span> all <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CopyOnWriteArrayList</span><span class="token operator">&lt;</span>Channel<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>4.新建Channel类一个客户代表一个Channel并新建receive()方法接受消息,send()方法发送消息，sendOthers()方法完成私聊和群聊，release()方法释放资源。</p>
<pre class=" language-java"><code class="language-java"><span class="token operator">/</span>一个客户代表一个Channel
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Channel</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
            <span class="token keyword">private</span> DataInputStream dis<span class="token punctuation">;</span>
            <span class="token keyword">private</span> DataOutputStream dos<span class="token punctuation">;</span>
            <span class="token keyword">private</span> Socket  client<span class="token punctuation">;</span>            
            <span class="token keyword">private</span> <span class="token keyword">boolean</span> isRunning<span class="token punctuation">;</span>
            <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
            <span class="token keyword">public</span> <span class="token function">Channel</span><span class="token punctuation">(</span>Socket  client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>client <span class="token operator">=</span> client<span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    dis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    dos <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    isRunning <span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token comment" spellcheck="true">//获取名称</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment" spellcheck="true">//欢迎你的到来</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"欢迎你的到来"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">sendOthers</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">"来到了本聊天室"</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---1------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    
                <span class="token punctuation">}</span>            
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">//接收消息</span>
            <span class="token keyword">private</span> String <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                String msg <span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    msg <span class="token operator">=</span>dis<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---2------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> msg<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment" spellcheck="true">//发送消息</span>
            <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>

                <span class="token comment" spellcheck="true">//时间显示</span>
                Date date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                SimpleDateFormat sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd HH:mm"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                String currentTime <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    dos<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>currentTime<span class="token operator">+</span><span class="token string">"\r\n"</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    dos<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment" spellcheck="true">//System.out.println("---3------");</span>
                    <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>



            <span class="token comment" spellcheck="true">//群聊</span>
            <span class="token comment" spellcheck="true">//私聊约定数据格式：@xxx:msg</span>
            <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">sendOthers</span><span class="token punctuation">(</span>String msg<span class="token punctuation">,</span><span class="token keyword">boolean</span> isSys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">boolean</span> isPrivate <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"@"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>isPrivate<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//私聊</span>
                    <span class="token keyword">int</span> idx <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment" spellcheck="true">//获取目标和数据</span>
                    String targetName <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>idx<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    msg <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>idx<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">for</span><span class="token punctuation">(</span>Channel other<span class="token operator">:</span>all<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>other<span class="token punctuation">.</span>name<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>targetName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            other<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">"私聊你： "</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">for</span><span class="token punctuation">(</span>Channel other<span class="token operator">:</span>all<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>other<span class="token operator">==</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//自己</span>
                            <span class="token keyword">continue</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isSys<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            other<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">"："</span><span class="token operator">+</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//群聊消息</span>
                        <span class="token punctuation">}</span>
                        <span class="token keyword">else</span> <span class="token punctuation">{</span>
                            other<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//系统消息</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>    
            <span class="token punctuation">}</span>
            <span class="token comment" spellcheck="true">//释放资源</span>
            <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>isRunning <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                ChatUtils<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>dis<span class="token punctuation">,</span>dos<span class="token punctuation">,</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment" spellcheck="true">//退出</span>
                all<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">sendOthers</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token operator">+</span><span class="token string">"离开了本聊天室"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">while</span><span class="token punctuation">(</span>isRunning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    String msg <span class="token operator">=</span> <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>msg<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token function">sendOthers</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
</code></pre>
<p>客户端(Client.java)</p>
<p>1.新建Client类完成客户端的编写</p>
<p>2.输入用户名新建连接，使用Socket创建客户端和指定的服务器端口和地址</p>
<p>3.客户端发送消息</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> UnknownHostException<span class="token punctuation">,</span>                 IOException <span class="token punctuation">{</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"-----Client-----"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        BufferedReader br <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span>     <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"请输入用户名："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String name <span class="token operator">=</span> br<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//1.建立连接，使用Socket创建客户端+服务的地址和端口</span>
        Socket client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token number">8889</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">//2.客户端发送消息</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Send</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Receive</span><span class="token punctuation">(</span>client<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Receive类(Receive.java)</p>
<p>1.使用多线程封装接收端</p>
<p>方法有接收消息,释放资源,重写run方法</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Receive</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> DataInputStream dis <span class="token punctuation">;</span>
    <span class="token keyword">private</span> Socket client<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isRunning<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">Receive</span><span class="token punctuation">(</span>Socket client<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>client <span class="token operator">=</span> client<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isRunning <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            dis <span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"====2====="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">//接收消息</span>
    <span class="token keyword">private</span> String <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        String msg <span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            msg <span class="token operator">=</span>dis<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"====4===="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> msg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        
        <span class="token keyword">while</span><span class="token punctuation">(</span>isRunning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            String msg <span class="token operator">=</span><span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>msg<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">//释放资源</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isRunning <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        ChatUtils<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>dis<span class="token punctuation">,</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
<p>Send类(Send.java)</p>
<p>1.使用多线程编写发送端</p>
<p>2.方法有从控制台获取信息，释放资源，重写多线程的run方法</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Send</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span><span class="token punctuation">{</span>
    <span class="token keyword">private</span> BufferedReader console<span class="token punctuation">;</span>
    <span class="token keyword">private</span> DataOutputStream dos<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Socket client<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isRunning<span class="token punctuation">;</span>
    <span class="token keyword">private</span> String name<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token function">Send</span><span class="token punctuation">(</span>Socket client<span class="token punctuation">,</span>String name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>client <span class="token operator">=</span> client<span class="token punctuation">;</span>
        console <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isRunning <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            dos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">//发送名称</span>
            <span class="token function">send</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// TODO Auto-generated catch block</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">//从控制台获取消息</span>
    <span class="token keyword">private</span> String <span class="token function">getStrFromConsole</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// TODO Auto-generated catch block</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">//发送消息</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">send</span><span class="token punctuation">(</span>String msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            dos<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            dos<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"---client------"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">//释放资源</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isRunning <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        ChatUtils<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span>dos<span class="token punctuation">,</span>client<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>isRunning<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            String msg <span class="token operator">=</span> <span class="token function">getStrFromConsole</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>msg<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">send</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
<p>工具类(ChatUtils.java)</p>
<p>1.释放资源的工具类</p>
<pre class=" language-java"><code class="language-java">
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatUtils</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//释放资源</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">close</span><span class="token punctuation">(</span>Closeable <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>targets<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>Closeable target<span class="token operator">:</span>targets<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>null <span class="token operator">!=</span> target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    target<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// TODO: handle exception</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="运行效果"><a href="#运行效果" class="headerlink" title="运行效果"></a>运行效果</h1><p><img src="https://s2.ax1x.com/2019/05/14/Eo53dI.png" alt="avatar"></p>
<h1 id="END"><a href="#END" class="headerlink" title="END"></a>END</h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/RoWe98/2019/12/24/JavaSocket/" data-id="ck4jwhkph000avo4ay0lwy57y" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Fix-Bug-Baidu-Aip" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/24/Fix-Bug-Baidu-Aip/" class="article-date">
  <time datetime="2019-12-24T13:14:52.721Z" itemprop="datePublished">2019-12-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/24/Fix-Bug-Baidu-Aip/">修改百度开放平台人脸识别错误[Python]json 错误xx is not JSON serializable</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="修改百度开放平台人脸识别错误-Python-json-错误xx-is-not-JSON-serializable"><a href="#修改百度开放平台人脸识别错误-Python-json-错误xx-is-not-JSON-serializable" class="headerlink" title="修改百度开放平台人脸识别错误[Python]json 错误xx is not JSON serializable"></a>修改百度开放平台人脸识别错误[Python]json 错误xx is not JSON serializable</h1><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>百度AI开放平台所用到的人脸识别功能，人体识别功能很多人特别喜欢用，但是！会遇到如下的错误：</p>
<pre><code>[Python]json 错误xx is not JSON serializable
</code></pre><p>那么如何解决这个问题呢？</p>
<p>很简单，如下所示：</p>
<p>首先打开你的terminal;windows的同学打开你的powershell或者cmd</p>
<p>如下所示 输入：</p>
<pre class=" language-bash"><code class="language-bash">    pip3 show baidu-aip
    或
    pip show baidu-aip
</code></pre>
<p><img src="https://s2.ax1x.com/2019/05/14/EohCfU.md.jpg" alt="avatar"></p>
<p>找到location的位置进入该位置</p>
<p>然后进入site-packages位置后输入：</p>
<pre><code>cd aip
ls
</code></pre><p>如下所示：</p>
<p><img src="https://s2.ax1x.com/2019/05/14/EohpkV.jpg" alt="avatar"></p>
<p>找到face.py 文件 用vim打开</p>
<pre><code>vim face.py
</code></pre><p>在文本结尾输入如下代码</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">class</span> <span class="token class-name">MyEncoder</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>JSONEncoder<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">default</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> isinstance<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> bytes<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> str<span class="token punctuation">(</span>obj<span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> json<span class="token punctuation">.</span>JSONEncoder<span class="token punctuation">.</span>default<span class="token punctuation">(</span>self<span class="token punctuation">,</span> obj<span class="token punctuation">)</span>
</code></pre>
<p>然后找到其中的 所有每个方法 例如match方法 在json.dump()那一行改为如下所示</p>
<p><img src="https://s2.ax1x.com/2019/05/14/EohNAP.md.jpg" alt="avatar"></p>
<p>在False后加入如下代码</p>
<pre><code>cls = MyEncoder
</code></pre><p>注意空格</p>
<p>注意：建议将face.py中的所有方法的json.dump()中都改为如上所示的内容，防止bug再次出现</p>
<h1 id="END"><a href="#END" class="headerlink" title="END"></a>END</h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/RoWe98/2019/12/24/Fix-Bug-Baidu-Aip/" data-id="ck4jwhkpa0005vo4a4rotb9lw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-DHT" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/12/24/DHT/" class="article-date">
  <time datetime="2019-12-24T13:14:52.721Z" itemprop="datePublished">2019-12-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/12/24/DHT/">离散哈特莱变换（DHT）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>author: RoWe98(RexRowe)</p>
<h1 id="离散哈特莱变换（DHT）"><a href="#离散哈特莱变换（DHT）" class="headerlink" title="离散哈特莱变换（DHT）"></a>离散哈特莱变换（DHT）</h1><h1 id="摘-要"><a href="#摘-要" class="headerlink" title="摘 要"></a>摘 要</h1><p>离散哈特莱变换（DHT）是一种与傅里叶变换相关的转换。类似于离散傅里叶变换。与傅里叶变换在信号处理及其他相关领域有相似的应用。<br>本设计介绍了DHT的定义以及使用C语言实现其算法。</p>
<p>关键字：傅里叶变换   哈特莱变换</p>
<h1 id="二、设计平台"><a href="#二、设计平台" class="headerlink" title="二、设计平台"></a>二、设计平台</h1><ul>
<li>Linux平台</li>
<li>GCC编译器</li>
<li>vim</li>
<li>windows</li>
<li>Visual Studio 2017</li>
</ul>
<h1 id="三、设计原理"><a href="#三、设计原理" class="headerlink" title="三、设计原理"></a>三、设计原理</h1><p><strong>DHT的定义</strong><br>设$\mathrm{x}(\mathrm{n}), \mathrm{n}=0,1, \ldots, \mathrm{N}-1 \mathrm{x}(\mathrm{n}), \mathrm{n}=0,1, \ldots, \mathrm{N}-1$为一实序列，其DHT定义为：</p>
<p>$$<br>\begin{aligned} X_{H}(k) &amp;=\operatorname{DHTEx(n)} ] \ &amp;=\sum_{n=0}^{N-1} x(n) \operatorname{cas}\left(\frac{2 \pi}{N} k n\right), \quad k=0,1, \cdots, N-1 \end{aligned}<br>$$</p>
<p>式中$\operatorname{cas}(a)=\cos (a)+\sin (a) \operatorname{cas}(a)=\cos (a)+\sin (a)$逆变换$(\mathrm{IDHT})$为：</p>
<p>$$<br>\begin{aligned} x(n) &amp;=\operatorname{IDHT}\left[X_{H}(k)\right] \ &amp;=(1 / N) \sum_{k=0}^{N-1} X_{H}(k) \operatorname{cas}\left(\frac{2 \pi}{N} k n\right), \quad n=0,1, \cdots, N-1 \end{aligned}<br>$$</p>
<p>DHT的正交证明：</p>
<p>$$<br>\sum_{k=0}^{N-1} \operatorname{cas}\left(\frac{2 \pi}{N} k n\right) \operatorname{cas}\left(\frac{2 \pi}{N} k m\right)=\sum_{k=0}^{N-1}\left[\cos \left(\frac{2 \pi}{N} k(n-m)\right)+\sin \left(\frac{2 \pi}{N} k(n+m)\right)\right]=\left{\begin{array}{ll}{N,} &amp; {k=0} \ {0,} &amp; {k \neq 0}\end{array}\right.<br>$$</p>
<p>DHT和DFT关系<br>用X(k)表示实序列x(n)的，用XH(k)表示x(n)的DHT，分别用XHe(k)， XHo(k)表示XH(k)的偶对称分量与奇对称分量，即：</p>
<p>$X_{\mathrm{H}}(k)=X_{\mathrm{He}}(k)+X_{\mathrm{Ho}}(k)$</p>
<p>其中:</p>
<p>$$<br>\begin{array}{c}{X_{H e}(k)=\frac{1}{2}\left[X_{H}(k)+X_{H}(N-k)\right]}{X_{H o}(k)=\frac{1}{2}\left[X_{H}(k)-X_{H}(N-k)\right]} \ {X(k)=X_{H e}(k)-j X_{H o}(k)} \ {X_{H}(k)=\operatorname{Re}[X(k)]-\operatorname{Im}[X(k)]} \ {X(k)=\frac{1}{2}\left[X_{H}(k)+X_{H}(N-k)\right]-\frac{1}{2} j\left[X_{H}(k)-X_{H}(N-k)\right]}\end{array}<br>$$</p>
<p><strong>DHT的优点</strong></p>
<ul>
<li><p>DHT为实值，避免了复数运算</p>
</li>
<li><p>DHT正反变换形式基本一致</p>
</li>
<li><p>DHT与DFT的转换容易实现</p>
</li>
</ul>
<p><strong>DHT的性质</strong></p>
<p>DHT的性质与DFT的性质类似，但由于DHT是实序列间的变换，有些性质有具体的表达形式。这里只给出结论。<br>设x(n)、y(n)的DHT分别为Xh(k)、Yh(k)。用符号x(n)↔Xh(k)表示Xh(k)=DHT(x(n))。</p>
<p>1.线性性<br><img src="https://s2.ax1x.com/2019/05/14/EoWnD1.png" alt></p>
<p>2.逆序列x(N-n)的DHT<br>$x(N-n) \leftrightarrow X_{\mathrm{H}}(\mathrm{N}-k)$</p>
<p>且<br>$$<br>\mathrm{X}<em>{\mathrm{H}}(\mathrm{N}-\mathrm{k})=\sum</em>{n=0}^{\mathrm{N}-1} x(n)\left[\cos \left(\frac{2 \pi}{\mathrm{N}} k n\right)-\sin \left(\frac{2 \pi}{N} k n\right)\right], \quad k=0,1, \cdots, N-1<br>$$</p>
<p>当k=0时，可得Xh(N)=Xh(0)。</p>
<p>3.循环位移的性质<br>$$<br>\begin{array}{l}{x\left(\left(n-n_{0}\right)<em>{N} R</em>{N}(n) \leftrightarrow X_{\mathrm{H}}(k) \cos \left(\frac{2 \pi}{N} k n_{0}\right)+X_{\mathrm{H}}(N-k) \sin \left(\frac{2 \pi}{N} k n_{0}\right)\right)} \ {x\left(\left(n+n_{0}\right)<em>{N} R</em>{N}(n) \leftrightarrow X_{\mathrm{H}}(k) \cos \left(\frac{2 \pi}{N} k n_{0}\right)-X_{\mathrm{H}}(N-k) \sin \left(\frac{2 \pi}{N} k n_{0}\right)\right)}\end{array}<br>$$</p>
<h1 id="四、实现代码"><a href="#四、实现代码" class="headerlink" title="四、实现代码"></a>四、实现代码</h1><p>【C语言】</p>
<pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;math.h></span></span>

<span class="token keyword">const</span> <span class="token keyword">int</span> N <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token keyword">float</span> PI <span class="token operator">=</span> <span class="token number">3.1416</span><span class="token punctuation">;</span>

<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span><span class="token keyword">float</span> <span class="token operator">&amp;</span>a<span class="token punctuation">,</span> <span class="token keyword">float</span> <span class="token operator">&amp;</span>b<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">float</span> t<span class="token punctuation">;</span>
    t <span class="token operator">=</span> a<span class="token punctuation">;</span>
    a <span class="token operator">=</span> b<span class="token punctuation">;</span>
    b <span class="token operator">=</span> t<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">bitrp</span><span class="token punctuation">(</span><span class="token keyword">float</span> xreal<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">float</span> ximag<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 位反转置换 Bit-reversal Permutation</span>
    <span class="token keyword">int</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> p<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> p <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i <span class="token operator">*</span><span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        p<span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        a <span class="token operator">=</span> i<span class="token punctuation">;</span>
        b <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> p<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            b <span class="token operator">=</span> <span class="token punctuation">(</span>b <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>a <span class="token operator">&amp;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// b = b * 2 + a % 2;</span>
            a <span class="token operator">>>=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// a = a / 2;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>b <span class="token operator">></span> i<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">swap</span><span class="token punctuation">(</span>xreal<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> xreal<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">swap</span><span class="token punctuation">(</span>ximag<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> ximag<span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">FFT</span><span class="token punctuation">(</span><span class="token keyword">float</span> xreal<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">float</span> ximag<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// 快速傅立叶变换，将复数 x 变换后仍保存在 x 中，xreal, ximag 分        //    别是 x 的实部和虚部</span>
    <span class="token keyword">float</span> wreal<span class="token punctuation">[</span>N <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> wimag<span class="token punctuation">[</span>N <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> treal<span class="token punctuation">,</span> timag<span class="token punctuation">,</span> ureal<span class="token punctuation">,</span> uimag<span class="token punctuation">,</span> arg<span class="token punctuation">;</span>
    <span class="token keyword">int</span> m<span class="token punctuation">,</span> k<span class="token punctuation">,</span> j<span class="token punctuation">,</span> t<span class="token punctuation">,</span> index1<span class="token punctuation">,</span> index2<span class="token punctuation">;</span>

    <span class="token function">bitrp</span><span class="token punctuation">(</span>xreal<span class="token punctuation">,</span> ximag<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// 计算 1 的前 n / 2 个 n 次方根的共轭复数 W'j = wreal [j] + i *         wimag [j] , j = 0, 1, ... , n / 2 - 1</span>
    arg <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> PI <span class="token operator">/</span> n<span class="token punctuation">;</span>
    treal <span class="token operator">=</span> <span class="token function">cos</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    timag <span class="token operator">=</span> <span class="token function">sin</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    wreal<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
    wimag<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> n <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        wreal<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> wreal<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> treal <span class="token operator">-</span> wimag<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> timag<span class="token punctuation">;</span>
        wimag<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> wreal<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> timag <span class="token operator">+</span> wimag<span class="token punctuation">[</span>j <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> treal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>m <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> m <span class="token operator">&lt;=</span> n<span class="token punctuation">;</span> m <span class="token operator">*</span><span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> k <span class="token operator">+</span><span class="token operator">=</span> m<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> m <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                index1 <span class="token operator">=</span> k <span class="token operator">+</span> j<span class="token punctuation">;</span>
                index2 <span class="token operator">=</span> index1 <span class="token operator">+</span> m <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
                t <span class="token operator">=</span> n <span class="token operator">*</span> j <span class="token operator">/</span> m<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 旋转因子 w 的实部在 wreal [] 中                    //的下标为 t</span>
                treal <span class="token operator">=</span> wreal<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">*</span> xreal<span class="token punctuation">[</span>index2<span class="token punctuation">]</span> <span class="token operator">-</span> wimag<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">*</span>                         ximag<span class="token punctuation">[</span>index2<span class="token punctuation">]</span><span class="token punctuation">;</span>
                timag <span class="token operator">=</span> wreal<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">*</span> ximag<span class="token punctuation">[</span>index2<span class="token punctuation">]</span> <span class="token operator">+</span> wimag<span class="token punctuation">[</span>t<span class="token punctuation">]</span> <span class="token operator">*</span>                         xreal<span class="token punctuation">[</span>index2<span class="token punctuation">]</span><span class="token punctuation">;</span>
                ureal <span class="token operator">=</span> xreal<span class="token punctuation">[</span>index1<span class="token punctuation">]</span><span class="token punctuation">;</span>
                uimag <span class="token operator">=</span> ximag<span class="token punctuation">[</span>index1<span class="token punctuation">]</span><span class="token punctuation">;</span>
                xreal<span class="token punctuation">[</span>index1<span class="token punctuation">]</span> <span class="token operator">=</span> ureal <span class="token operator">+</span> treal<span class="token punctuation">;</span>
                ximag<span class="token punctuation">[</span>index1<span class="token punctuation">]</span> <span class="token operator">=</span> uimag <span class="token operator">+</span> timag<span class="token punctuation">;</span>
                xreal<span class="token punctuation">[</span>index2<span class="token punctuation">]</span> <span class="token operator">=</span> ureal <span class="token operator">-</span> treal<span class="token punctuation">;</span>
                ximag<span class="token punctuation">[</span>index2<span class="token punctuation">]</span> <span class="token operator">=</span> uimag <span class="token operator">-</span> timag<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>



<span class="token keyword">void</span> <span class="token function">FFT_test</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">float</span> xreal<span class="token punctuation">[</span>N<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> ximag<span class="token punctuation">[</span>N<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">int</span> n <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"请输入数据，格式(实部 虚部) : \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">scanf</span><span class="token punctuation">(</span><span class="token string">"%f%f"</span><span class="token punctuation">,</span>xreal<span class="token operator">+</span>i<span class="token punctuation">,</span>ximag<span class="token operator">+</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    n <span class="token operator">=</span> i<span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// 要求 n 为 2 的整数幂</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">></span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%d is not a power of 2! "</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        i <span class="token operator">/</span><span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">FFT</span><span class="token punctuation">(</span>xreal<span class="token punctuation">,</span> ximag<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"=====================================\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"FFT:    i          实部       虚部 \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"     %4d       %8.4f    %8.4f "</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> xreal<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span>             ximag<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"===================================== \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"DHT:    i        结果 \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"     %4d        %8.4f "</span><span class="token punctuation">,</span> i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> xreal<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span>ximag<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"=====================================\n "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">FFT_test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<h1 id="运行效果"><a href="#运行效果" class="headerlink" title="运行效果"></a>运行效果</h1><pre class=" language-bash"><code class="language-bash">请输入数据，格式<span class="token punctuation">(</span>实部 虚部<span class="token punctuation">)</span> <span class="token keyword">:</span> 
1 0
2 0
3 0
4 0
5 0
6 0
7 0
8 0
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
FFT:    i          实部       虚部 
        1        36.0000      0.0000 
        2        -4.0000      9.6568 
        3        -4.0000      4.0000 
        4        -4.0000      1.6569 
        5        -4.0000      0.0000 
        6        -4.0000     -1.6568 
        7        -4.0000     -4.0000 
        8        -4.0001     -9.6569 
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span> 
DHT:    i        结果 
        1         36.0000 
        2        -13.6568 
        3         -8.0000 
        4         -5.6568 
        5         -4.0000 
        6         -2.3432 
        7         -0.0000 
        8          5.6568 
<span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span>
</code></pre>
<h1 id="End"><a href="#End" class="headerlink" title="End"></a>End</h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/RoWe98/2019/12/24/DHT/" data-id="ck4jwhkpe0007vo4a19301nij" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-PyQt_Trial" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/20/PyQt_Trial/" class="article-date">
  <time datetime="2019-07-20T15:42:28.000Z" itemprop="datePublished">2019-07-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/20/PyQt_Trial/">PyQt入门（第一个PyQt应用）</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="PyQt入门（第一个PyQt应用）"><a href="#PyQt入门（第一个PyQt应用）" class="headerlink" title="PyQt入门（第一个PyQt应用）"></a>PyQt入门（第一个PyQt应用）</h1><h2 id="一、PyQt介绍"><a href="#一、PyQt介绍" class="headerlink" title="一、PyQt介绍"></a>一、PyQt介绍</h2><p>PyQt是一个创建GUI应用程序的工具包。它是<a href="https://baike.baidu.com/item/Python" target="_blank" rel="noopener">Python</a>编程语言和<a href="https://baike.baidu.com/item/Qt" target="_blank" rel="noopener">Qt</a>库的成功融合。Qt库是目前最强大的库之一。PyQt是由Phil Thompson 开发。</p>
<p><strong>PyQt</strong>实现了一个Python模块集。它有超过300类，将近6000个函数和方法。它是一个多平台的工具包，可以运行在所有主要操作系统上，包括UNIX，Windows和Mac。 <strong>PyQt</strong>采用双许可证，开发人员可以选择GPL和商业许可。在此之前，GPL的版本只能用在Unix上，从<strong>PyQt</strong>的版本4开始，GPL许可证可用于所有支持的平台。</p>
<h2 id="二、python-GUI框架简介，pyqt介绍，为什么使用pyqt"><a href="#二、python-GUI框架简介，pyqt介绍，为什么使用pyqt" class="headerlink" title="二、python GUI框架简介，pyqt介绍，为什么使用pyqt"></a>二、python GUI框架简介，pyqt介绍，为什么使用pyqt</h2><h4 id="python开发GUI程序，了解一个框架需要了解："><a href="#python开发GUI程序，了解一个框架需要了解：" class="headerlink" title="python开发GUI程序，了解一个框架需要了解："></a>python开发GUI程序，了解一个框架需要了解：</h4><p>（1）运行效果<br> （2）能够运行在哪些平台<br> （3）学习成本，因为每一个GUI框架都有自己的特点<br> （4）开发效率的比较，python的运行效率比c c++低，但是开发效率是比较快的</p>
<h3 id="python-GUI框架"><a href="#python-GUI框架" class="headerlink" title="python GUI框架:"></a>python GUI框架:</h3><p>（1）<strong>Tkinter</strong>: python内置的GUI框架，使用TCL实现，python中内嵌了TCL解释器，使用它的时候不用安装额外的扩展包，直接import，跨平台。不足之处在于UI布局全靠代码实现，只有15种常用部件，显示效果简陋。<br> （2）<strong>Wxpython</strong>：用得比较广泛，跨平台，C++编写，需要安装扩展模块；文档少，遇到问题不好解决，代码布局控件，不直观。<br> （3）<strong>Pygtk</strong>： python对GTK+GUI库的封装，在linux平台上运行的比较好，需要安装扩展模块，在windows下的兼容性有一些问题。<br> （4）<strong>pyqt</strong>：QT原本是诺基亚的产品，源码用C++写的，python对QT的包装，跨平台，本地显示效果，根据系统决定，在win7下就是win7的显示效果；pyqt与qt的函数接口一致，qt开发问的那个丰富，所以pyqt开发文档也比较丰富；控件丰富，函数/方法多，拖曳布局；方便打包成二进制文件；GPL协议，商业程序需要购买商业版授权<br> （5）<strong>pyside</strong>：诺基亚的亲儿子，python对QT的封装，安装扩展模块，跨平台，与pyqt的API一样，LGPL协议，新软件可以是私有的，代码布局<br> （6）<strong>Kivy</strong>： 针对多点触控程序，智能手机平板等，也可以在没有触屏功能的系统上，全平台支持；使用python和cython（python和c语言的接口）编写；中文支持差，需要自己下载中文库并且制定路径。</p>
<h3 id="为什么使用pyqt："><a href="#为什么使用pyqt：" class="headerlink" title="为什么使用pyqt："></a>为什么使用pyqt：</h3><ol>
<li>因为API与qt一致，学会了pyqt再使用qt很简单</li>
<li>文档丰富</li>
<li>学习成本低</li>
<li>开发迅速，qt designer拖曳布局，如果使用代码布局还需要构建全局并且调试</li>
<li>学习经验容易迁移到pyside来开发商业应用</li>
<li>方便打包发布软件，python本身解释语言的特点是写好的程序不编译和链接，使用文本运行解释器，边解释边执行，用户不可能装一个解释器再发源码再执行，所以打包成exe再发布</li>
</ol>
<h2 id="三、安装与配置"><a href="#三、安装与配置" class="headerlink" title="三、安装与配置"></a>三、安装与配置</h2><h3 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h3><p><strong>安装pyqt5</strong></p>
<p><code>pip install pyqt5</code> <strong>or</strong> <code>pip3 install pyqt5</code></p>
<p><strong>Windows安装PyQt-tools</strong></p>
<p><code>pip3 install pyqt5-tools</code></p>
<p><strong>Mac和Linux都不支持PyQt5-tools所以直接安装Qt Designer即可</strong></p>
<ul>
<li><p>Mac</p>
<p><code>pip install Qt</code></p>
</li>
<li><p>Linux</p>
<p>注：由于我用的Manjaro已经内置了Qt Designer，所以这里写ubuntu下的安装方法</p>
<p><code>sudo apt-get install qt5-default qttools5-dev-tools</code></p>
</li>
</ul>
<p><strong>terminal中查看是否安装成功PyQt</strong></p>
<pre class=" language-bash"><code class="language-bash"> rex@rex-linux  ~  pip list
Package              Version 
-------------------- --------
appdirs              1.4.3   
btrfsutil            1.1.1   
CacheControl         0.12.5  
chardet              3.0.4   
colorama             0.4.1   
cupshelpers          1.0     
distlib              0.2.9   
distro               1.4.0   
docopt               0.6.2   
html5lib             1.0.1   
idna                 2.8     
Jade-Application-Kit 2.0.7   
keyutils             0.5     
lockfile             0.12.2  
louis                3.10.0  
msgpack              0.6.1   
npyscreen            4.10.5  
numpy                1.16.4  
opencv-python        4.1.0.25
packaging            19.0    
pacman-mirrors       4.14.2  
pep517               0.5.0   
Pillow               6.1.0   
pip                  19.0.3  
progress             1.5     
pwquality            1.4.0   
pycairo              1.18.1  
pycups               1.9.74  
pycurl               7.43.0.2
PyGObject            3.32.2  
pyparsing            2.4.0   
PyQt5                5.13.0  
PyQt5-sip            4.19.18 
pysmbc               1.0.16  
pytoml               0.1.20  
PyYAML               5.1     
reportlab            3.5.23  
requests             2.22.0  
retrying             1.3.3   
setuptools           41.0.1  
six                  1.12.0  
team                 1.0     
udiskie              1.7.7   
urllib3              1.25.3  
webencodings         0.5.1 
</code></pre>
<p><strong>如图所示我们已经安装成功了PyQt5</strong></p>
<h3 id="2-配置"><a href="#2-配置" class="headerlink" title="2.配置"></a>2.配置</h3><p>若你已经可以在你的应用程序菜单里找到Qt Designer那就可以了</p>
<p><img src="https://s2.ax1x.com/2019/07/20/eS1iCT.png" alt></p>
<p><strong>PyCharm配置</strong></p>
<p>注：PyCharm安装激活方法自行百度，这里不提供</p>
<ul>
<li>打开PyCharm</li>
<li><code>File</code>-&gt;<code>Setting</code>-&gt;<code>Tools</code>-&gt;<code>External Tools</code></li>
</ul>
<p><img src="https://s2.ax1x.com/2019/07/20/eS1Uat.png" alt></p>
<ul>
<li><p>点击加号，依次填入</p>
<pre><code>Name:Qt Designer

Group:Qt

Program:usr/local/designer

Arguements:$FileName$

Working directory:$ProjectFileDir$
</code></pre></li>
</ul>
<p><img src="https://s2.ax1x.com/2019/07/20/eS1wPf.png" alt></p>
<ul>
<li><p>再次点击加号输入</p>
<pre><code>Name:PyUIC

Group:Qt

Program:/usr/bin/python3

Arguements:-m PyQt5.uic.pyuic $FileName$ -o $FileNameWithoutExtension$.py

Working directory:$FileDir$
</code></pre></li>
</ul>
<p><img src="https://s2.ax1x.com/2019/07/20/eS38YV.png" alt></p>
<ul>
<li><code>Ok</code>-&gt;<code>Apply</code></li>
</ul>
<p><strong>到这里PyCharm的配置基本结束</strong></p>
<h2 id="四、第一个PyQt-GUI应用程序"><a href="#四、第一个PyQt-GUI应用程序" class="headerlink" title="四、第一个PyQt GUI应用程序"></a>四、第一个PyQt GUI应用程序</h2><h3 id="1-UI设计"><a href="#1-UI设计" class="headerlink" title="1.UI设计"></a>1.UI设计</h3><ul>
<li><p>打开PyCharm新建一个基于venv的python项目</p>
</li>
<li><p>在Setting的Project interpreter中查看是否有PyQt没有的话自行添加</p>
</li>
</ul>
<p><img src="https://s2.ax1x.com/2019/07/20/eS30T1.png" alt></p>
<ul>
<li>打开<code>Tools</code>-&gt;<code>QT</code>-&gt;<code>Qt Designer</code></li>
</ul>
<p><img src="https://s2.ax1x.com/2019/07/20/eS3f0A.jpg" alt></p>
<ul>
<li>新建一个MainWindow ui界面</li>
</ul>
<p><img src="https://s2.ax1x.com/2019/07/20/eS3b6g.png" alt></p>
<ul>
<li>向上拖拉控件并保存名为<code>firstMainWindow.ui</code></li>
</ul>
<p><img src="https://s2.ax1x.com/2019/07/20/eS3qXQ.png" alt></p>
<h3 id="2-ui文件转换为-py文件与代码编写和运行"><a href="#2-ui文件转换为-py文件与代码编写和运行" class="headerlink" title="2.ui文件转换为.py文件与代码编写和运行"></a>2.ui文件转换为.py文件与代码编写和运行</h3><p><strong>要想.ui文件可以被我们程序读取有两种方法</strong></p>
<ul>
<li><p>使用命令行来将.ui编译为.py文件</p>
<pre><code>pyuic5 -o firstMainWindow.py firstMainWindow.ui
</code></pre><p>编译完成后的firstMainWindow.py文件内容</p>
</li>
</ul>
<pre class=" language-python"><code class="language-python">  <span class="token keyword">from</span> PyQt5 <span class="token keyword">import</span> QtCore<span class="token punctuation">,</span> QtGui<span class="token punctuation">,</span> QtWidgets


  <span class="token keyword">class</span> <span class="token class-name">Ui_MainWindow</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">:</span>
      <span class="token keyword">def</span> <span class="token function">setupUi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> MainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
          MainWindow<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">)</span>
          MainWindow<span class="token punctuation">.</span>resize<span class="token punctuation">(</span><span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>centralwidget <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QWidget<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"centralwidget"</span><span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>listWidget <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QListWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>listWidget<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">140</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">,</span> <span class="token number">531</span><span class="token punctuation">,</span> <span class="token number">371</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>listWidget<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"listWidget"</span><span class="token punctuation">)</span>
          MainWindow<span class="token punctuation">.</span>setCentralWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>centralwidget<span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>menubar <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QMenuBar<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>menubar<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span>QtCore<span class="token punctuation">.</span>QRect<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>menubar<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"menubar"</span><span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>menuFile <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QMenu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>menubar<span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>menuFile<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"menuFile"</span><span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>menuEdit <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QMenu<span class="token punctuation">(</span>self<span class="token punctuation">.</span>menubar<span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>menuEdit<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"menuEdit"</span><span class="token punctuation">)</span>
          MainWindow<span class="token punctuation">.</span>setMenuBar<span class="token punctuation">(</span>self<span class="token punctuation">.</span>menubar<span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>statusbar <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QStatusBar<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>statusbar<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"statusbar"</span><span class="token punctuation">)</span>
          MainWindow<span class="token punctuation">.</span>setStatusBar<span class="token punctuation">(</span>self<span class="token punctuation">.</span>statusbar<span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>actionNew <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QAction<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>actionNew<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"actionNew"</span><span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>actionOpen <span class="token operator">=</span> QtWidgets<span class="token punctuation">.</span>QAction<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>actionOpen<span class="token punctuation">.</span>setObjectName<span class="token punctuation">(</span><span class="token string">"actionOpen"</span><span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>menuFile<span class="token punctuation">.</span>addAction<span class="token punctuation">(</span>self<span class="token punctuation">.</span>actionNew<span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>menuFile<span class="token punctuation">.</span>addAction<span class="token punctuation">(</span>self<span class="token punctuation">.</span>actionOpen<span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>menubar<span class="token punctuation">.</span>addAction<span class="token punctuation">(</span>self<span class="token punctuation">.</span>menuFile<span class="token punctuation">.</span>menuAction<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>menubar<span class="token punctuation">.</span>addAction<span class="token punctuation">(</span>self<span class="token punctuation">.</span>menuEdit<span class="token punctuation">.</span>menuAction<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

          self<span class="token punctuation">.</span>retranslateUi<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>
          QtCore<span class="token punctuation">.</span>QMetaObject<span class="token punctuation">.</span>connectSlotsByName<span class="token punctuation">(</span>MainWindow<span class="token punctuation">)</span>

      <span class="token keyword">def</span> <span class="token function">retranslateUi</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> MainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
          _translate <span class="token operator">=</span> QtCore<span class="token punctuation">.</span>QCoreApplication<span class="token punctuation">.</span>translate
          MainWindow<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"MainWindow"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>menuFile<span class="token punctuation">.</span>setTitle<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"File"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>menuEdit<span class="token punctuation">.</span>setTitle<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"Edit"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>actionNew<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"New"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          self<span class="token punctuation">.</span>actionOpen<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>_translate<span class="token punctuation">(</span><span class="token string">"MainWindow"</span><span class="token punctuation">,</span> <span class="token string">"Open"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre>
<ul>
<li><p>使用代码直接读取.ui文件</p>
<p>这里我们还是依旧两种方法来读取.ui文件</p>
<p>1.使用我们编译好的firstMainWindow.py文件</p>
<p>2.直接读取.ui文件</p>
<ul>
<li><p>使用firstMainWindow.py文件</p>
<p>编写一个叫CallFirstMainWin.py文件,内容如下</p>
</li>
</ul>
</li>
</ul>
<pre class=" language-python"><code class="language-python">    <span class="token keyword">import</span> sys
    <span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span>  QApplication<span class="token punctuation">,</span> QMainWindow
    <span class="token keyword">from</span> firstMainWin <span class="token keyword">import</span> <span class="token operator">*</span>
    <span class="token keyword">class</span> <span class="token class-name">MyMainWindow</span><span class="token punctuation">(</span>QMainWindow<span class="token punctuation">,</span> Ui_MainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>


        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token operator">=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
            super<span class="token punctuation">(</span>MyMainWindow<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>setupUi<span class="token punctuation">(</span>self<span class="token punctuation">)</span>


    <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
        app<span class="token operator">=</span>QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
        myWin <span class="token operator">=</span> MyMainWindow<span class="token punctuation">(</span><span class="token punctuation">)</span>
        myWin<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<pre><code>这里我们继承了firstMainWindow.py中的Ui_MainWindow类来使用我们设计的UI
</code></pre><ul>
<li>直接读取.ui文件</li>
</ul>
<pre class=" language-python"><code class="language-python">    <span class="token keyword">import</span> sys
    <span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span>  QApplication<span class="token punctuation">,</span> QMainWindow
    <span class="token keyword">from</span> firstMainWin <span class="token keyword">import</span> <span class="token operator">*</span>
    <span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>uic <span class="token keyword">import</span> loadUi

    app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span>
    widget <span class="token operator">=</span> loadUi<span class="token punctuation">(</span><span class="token string">'firstMainWin.ui'</span><span class="token punctuation">)</span>
    widget<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span>app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre>
<pre><code>这里是直接使用了```loadUi```方法来读取了ui文件
</code></pre><p>  <strong>注意：为了保障界面与逻辑分离我们大部分情况下都使用第一种方法，通过继承界面文件的主窗口类来完成界面和逻辑的分离</strong></p>
<ul>
<li><p>运行</p>
<p><img src="https://s2.ax1x.com/2019/07/20/eStTsO.png" alt></p>
</li>
</ul>
<p>两种方式都可以成功运行</p>
<h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/RoWe98/2019/07/20/PyQt_Trial/" data-id="ck4jwhkpq000gvo4aakiwuu3x" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PyQt/">PyQt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bodcom_failure" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/19/bodcom_failure/" class="article-date">
  <time datetime="2019-07-19T04:42:28.000Z" itemprop="datePublished">2019-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/19/bodcom_failure/">论如何在linux上正确驱动博通网卡</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="论如何在linux上正确驱动博通网卡"><a href="#论如何在linux上正确驱动博通网卡" class="headerlink" title="论如何在linux上正确驱动博通网卡"></a>论如何在linux上正确驱动博通网卡</h1><h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>我的网卡型号是BCM94360，前几天安装了基于Arch Linux的Linux发行版Manjaro出现了无法识别无线网卡驱动的问题</p>
<pre class=" language-bash"><code class="language-bash">➜  ~ lspci <span class="token operator">|</span> <span class="token function">grep</span> -i net            
00:19.0 Ethernet controller: Intel Corporation Ethernet Connection <span class="token punctuation">(</span>3<span class="token punctuation">)</span> I218-LM <span class="token punctuation">(</span>rev 03<span class="token punctuation">)</span>
03:00.0 Network controller: Broadcom Inc. and subsidiaries BCM4360 802.11ac Wireless Network Adapter <span class="token punctuation">(</span>rev 03<span class="token punctuation">)</span>
</code></pre>
<p>如上所示，在命令行输入<code>lspci | grep -i net</code>后可以查看自己的无线网卡的型号，我的型号为<strong>BCM4360</strong></p>
<p><strong>问题描述</strong></p>
<ul>
<li>找不到无线网络</li>
<li>找不到无线开关</li>
</ul>
<h2 id="解决"><a href="#解决" class="headerlink" title="解决"></a>解决</h2><p>在我通过bing，baidu，google后找到了基本的解决思路，是因为没有安装对应的网卡驱动</p>
<p><strong>安装驱动</strong></p>
<p><strong>1.更新系统软件</strong><br><code>sudo pacman -Syu</code></p>
<p><strong>2.安装对应的linux-headers</strong></p>
<ul>
<li><p>在设置中找到自己系统版本对应的内核<br><img src="https://s2.ax1x.com/2019/07/19/ZvKNIe.png" alt><br>如上所示我的内核版本为<code>Linux 4.19.59-1</code></p>
</li>
<li><p><code>sudo pacman -S linux-headers</code><br>这里选择对应上面的<code>Linux 4.19.59-1</code>版本的即可</p>
</li>
<li><p>安装博通网卡驱动<code>sudo pacman -S broadcom-wl-dkms</code></p>
</li>
</ul>
<p><strong>3.重启</strong></p>
<p><strong>重启过后继续继续输入<code>dkms status</code></strong></p>
<p>若显示如下则说明安装成功</p>
<pre class=" language-bash"><code class="language-bash">➜  ~ dkms status                    
broadcom-wl, 6.30.223.271, 4.19.59-1-MANJARO, x86_64: installed
</code></pre>
<p><strong>到这大部分博通的网卡应该都可以解决wifi的问题</strong></p>
<h2 id="但是"><a href="#但是" class="headerlink" title="但是"></a>但是</h2><p>我出现了新的问题，搜索不到wifi</p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZvMCdO.jpg" alt></p>
<p><strong>WDNMD!!</strong></p>
<p><strong>解决方法</strong></p>
<p>淘宝买了一个linux免驱的无线网卡</p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZvMeyt.jpg" alt></p>
<p><strong>怎么说？ WDNMD！ 白给了！</strong></p>
<p><img src="https://s2.ax1x.com/2019/07/19/ZvM3Wj.gif" alt></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/RoWe98/2019/07/19/bodcom_failure/" data-id="ck4jwhkq0000tvo4apd5cjppc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Linux/">Linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ManjaroInstall" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/18/ManjaroInstall/" class="article-date">
  <time datetime="2019-07-18T11:19:22.000Z" itemprop="datePublished">2019-07-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/18/ManjaroInstall/">世界第一linux发行版——Manjaro</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="世界第一的linux发行版-——-Manjaro"><a href="#世界第一的linux发行版-——-Manjaro" class="headerlink" title="世界第一的linux发行版 —— Manjaro"></a>世界第一的linux发行版 —— Manjaro</h1><h2 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h2><p>也算是了却了自己的一个心事吧，之前一直想装个Arch Linux玩玩但是Arch Linux的安装实在是特别繁琐，于是在google的过程中发现了Linux发行版的排行榜，发现了Manjaro竟然已经到了全球第一的地位。<a href="https://manjaro.org/" target="_blank" rel="noopener">Manjaro</a>这个Linux发现版我之前也算了解过。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><strong>Manjaro官方版本</strong></p>
<ul>
<li>xfce版(64)</li>
<li>kde版(64)</li>
<li>gnome版(64)</li>
<li>Architect版</li>
<li>Arm版</li>
<li>32位版(xfce)</li>
<li>社区版(deepin桌面版,等等)</li>
</ul>
<p>这些版本你在<a href="https://manjaro.org/" target="_blank" rel="noopener">Manjaro的官方网站</a>的下载页面可以查看到具体的区别</p>
<p><img src="https://s2.ax1x.com/2019/07/18/ZjVFSK.png" alt></p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><strong>1.下载镜像</strong></p>
<p><a href="https://manjaro.org/get-manjaro/" target="_blank" rel="noopener">Manjaro下载地址</a></p>
<p><strong>2.刻录镜像</strong></p>
<p>这里我使用的是<a href="https://rufus.ie/" target="_blank" rel="noopener">refus</a>这个刻录软件<br><img src="https://s2.ax1x.com/2019/07/18/ZjV1l8.png" alt></p>
<p><strong>这里是截取的官方的图所以显示ubuntu不要纠结</strong><br><strong>如果弹窗提示请选择dd</strong></p>
<p><strong>3.安装</strong></p>
<p>这里简单说说基本就是这几个步骤</p>
<ul>
<li>u盘启动</li>
<li>选择安装</li>
<li>重启</li>
</ul>
<h2 id="系统配置"><a href="#系统配置" class="headerlink" title="系统配置"></a>系统配置</h2><p>先给大家看看我安装之后的样子</p>
<p><img src="https://s2.ax1x.com/2019/07/18/ZjVWfx.png" alt></p>
<p><strong>先排列源</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> pacman-mirrors -g
</code></pre>
<p><strong>同步并优化（类似磁盘整理，固态硬盘无需操作）</strong><br><code>sudo pacman-optimize &amp;&amp; sync</code><br><strong>升级系统</strong><br><code>sudo pacman -Syyu</code><br><strong>添加中科大源</strong><br>打开配置文件在文件末尾添加</p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/pacman.conf
<span class="token punctuation">[</span>archlinuxcn<span class="token punctuation">]</span>
SigLevel <span class="token operator">=</span> Optional TrustedOnly
Server <span class="token operator">=</span> https://mirrors.ustc.edu.cn/archlinuxcn/<span class="token variable">$arch</span>
</code></pre>
<p><strong>导入GPG Key</strong><br><code>sudo pacman -Syy &amp;&amp; sudo pacman -S archlinuxcn-keyring</code><br>现在可以安装软件了，比如 chrome 和搜狗拼音输入法</p>
<p><strong>安装搜狗输入法</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">sudo</span> pacman -S fcitx-sogoupinyin
<span class="token function">sudo</span> pacman -S fcitx-im
<span class="token function">sudo</span> pacman -S fcitx-configtool <span class="token comment" spellcheck="true"># 图形化的配置工具</span>
</code></pre>
<p><strong>需要修改配置文件 ~/.xprofile<br>添加如下语句</strong></p>
<pre class=" language-bash"><code class="language-bash"><span class="token function">export</span> GTK_IM_MODULE<span class="token operator">=</span>fcitx
<span class="token function">export</span> QT_IM_MODULE<span class="token operator">=</span>fcitx
<span class="token function">export</span> XMODIFIERS<span class="token operator">=</span><span class="token string">"@im=fcitx"</span>
</code></pre>
<p><strong>安装包管理工具yaourt</strong><br><code>pacman -S yaourt</code></p>
<p>这个管理工具可以帮助你安装aur源上的程序</p>
<p>通过这个工具你可以安装deepin打包的各种软件，例如:</p>
<ul>
<li>微信</li>
<li>QQ</li>
<li>百度网盘</li>
<li>等等</li>
</ul>
<p>通过下面的语句安装</p>
<pre><code>yaourt -S deepin-wine-qq
yaourt -S deepin-wine-pan
yaourt -S deepin-wine-wechat
</code></pre><p><img src="https://s2.ax1x.com/2019/07/18/Zje0LF.png" alt></p>
<p>安装的话就是输入对应的你想安装的程序前的序号即可</p>
<p><strong>修复kde桌面运行deepin-wine程序闪退的错误</strong></p>
<p>在非gnome桌面环境下，Deepin-Wine软件大部分不能启动，例如deepin-Tim，deepin-QQ以及微信等。按照DLM的说法，深度在打包Deepin-Wine软件时加入了对Gnome的依赖。通过安装<code>gnome-settings-daemon</code>即可解决。</p>
<p>1.安装gnome-settings-daemon<br><code>sudo apt install gnome-settings-daemon</code></p>
<p>2.复制org.gnome.SettingsDaemon.XSettings.desktop<br><code>cp /etc/xdg/autostart/org.gnome.SettingsDaemon.XSettings.desktop ~/.config/autostart</code></p>
<p>3.设置org.gnome.SettingsDaemon.XSettings.desktop开机自启</p>
<p>在KDE中的一个简单的配置方法是：打开<code>系统设置</code>-&gt;<code>开机和关机</code>-&gt;<code>自动启动</code>-&gt;<code>设置为已启用</code>-&gt;<code>最后注销登录</code>或者<code>重启电脑</code>即可打开Deepin-Wine软件。（其他非KDE桌面环境，方法自己参考）</p>
<p><img src="https://s2.ax1x.com/2019/07/18/ZjebWt.png" alt></p>
<p><strong>记得选择</strong>高级中的如下选项</p>
<p><img src="https://s2.ax1x.com/2019/07/18/ZjmCYn.png" alt></p>
<p>然后你就可以正常运行deepin打包的wine软件了</p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p><strong>常用软件安装</strong></p>
<pre><code>谷歌浏览器
pacman -S google-chrome
国内版火狐浏览器
pacman -S firefox firefox-i18n-zh-cn
压缩解压缩
pacman -S file-roller unrar unzip p7zip
Git ssh
pacman -S git openssh
安装wps
yaourt -S wps-office
VSCode
pacman -S visual-studio-code-bin 
</code></pre><p><strong>pacman和yaourt常用命令</strong></p>
<pre><code>安装 pacman -S
删除 pacman -R
移除已安装不需要软件包 pacman -Rs
删除一个包,所有依赖 pacman -Rsc
升级包 pacman -Syu
查询包数据库 pacman -Ss
搜索以安装的包 pacman -Qs
显示包大量信息 pacman -Si
本地安装包 pacman -Qi
清理包缓存 pacman -Sc 
</code></pre><h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/RoWe98/2019/07/18/ManjaroInstall/" data-id="ck4jwhkpi000bvo4aocypz71j" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-C#  学习笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/07/10/C#  学习笔记/" class="article-date">
  <time datetime="2019-07-10T13:55:54.000Z" itemprop="datePublished">2019-07-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/07/10/C#  学习笔记/">C#学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="C-学习笔记"><a href="#C-学习笔记" class="headerlink" title="C#学习笔记"></a>C#学习笔记</h1><h2 id="C-程序结构"><a href="#C-程序结构" class="headerlink" title="C#程序结构"></a>C#程序结构</h2><p>C# 中的关键组织结构概念包括<strong>程序</strong>、<strong>命名空间</strong>、<strong>类型</strong>、<strong>成员</strong>和<strong>程序集</strong>。 C# 程序由一个或多个源文件组成。 程序声明类型，而类型则包含成员，并被整理到命名空间中。 类型示例包括类和接口。 成员示例包括字段、方法、属性和事件。 编译完的 C# 程序实际上会打包到程序集中。 程序集的文件扩展名通常为 <code>.exe</code> 或 <code>.dll</code>，具体取决于实现的是<strong><em>应用程序</em></strong>还是<strong><em>库</em></strong>。</p>
<p>以下示例在 <code>Acme.Collections</code> 命名空间中声明 <code>Stack</code> 类：</p>
<p>C#</p>
<pre class=" language-csharp"><code class="language-csharp"><span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">namespace</span> Acme<span class="token punctuation">.</span>Collections
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Stack</span>
    <span class="token punctuation">{</span>
        Entry top<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">Push</span><span class="token punctuation">(</span><span class="token keyword">object</span> data<span class="token punctuation">)</span> 
        <span class="token punctuation">{</span>
            top <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Entry</span><span class="token punctuation">(</span>top<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">object</span> <span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>top <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">object</span> result <span class="token operator">=</span> top<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
            top <span class="token operator">=</span> top<span class="token punctuation">.</span>next<span class="token punctuation">;</span>
            <span class="token keyword">return</span> result<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">class</span> <span class="token class-name">Entry</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">public</span> Entry next<span class="token punctuation">;</span>
            <span class="token keyword">public</span> <span class="token keyword">object</span> data<span class="token punctuation">;</span>
            <span class="token keyword">public</span> <span class="token function">Entry</span><span class="token punctuation">(</span>Entry next<span class="token punctuation">,</span> <span class="token keyword">object</span> data<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>next <span class="token operator">=</span> next<span class="token punctuation">;</span>
                <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>此类的完全限定的名称为 <code>Acme.Collections.Stack</code>。 此类包含多个成员：一个 <code>top</code> 字段、两个方法（<code>Push</code> 和 <code>Pop</code>）和一个 <code>Entry</code> 嵌套类。 <code>Entry</code> 类还包含三个成员：一个 <code>next</code> 字段、一个 <code>data</code> 字段和一个构造函数。 假定示例的源代码存储在 <code>acme.cs</code> 文件中，以下命令行</p>
<pre><code>csc /t:library acme.cs
</code></pre><p>将示例编译成库（不含 <code>Main</code> 入口点的代码），并生成 <code>acme.dll</code> 程序集。</p>
<p> 重要</p>
<p>上述示例使用 <code>csc</code> 作为命令行 C# 编译器。 此编译器是 Windows 可执行文件。 若要在其他平台上使用 C#，应使用 .NET Core 工具。 .NET Core 生态系统使用 <code>dotnet</code> CLI 来管理命令行生成。 这包括管理依赖项和调用 C# 编译器。 有关在 .NET Core 支持的平台上使用这些工具的完整说明，请参阅<a href="https://docs.microsoft.com/zh-cn/dotnet/core/tutorials/using-with-xplat-cli" target="_blank" rel="noopener">这篇教程</a>。</p>
<p>程序集包含中间语言 (IL) 指令形式的可执行代码和元数据形式的符号信息。 执行前，程序集中的 IL 代码会被 .NET 公共语言运行时的实时 (JIT) 编译器自动转换成处理器专属代码。</p>
<p>由于程序集是包含代码和元数据的自描述功能单元，因此无需在 C# 中使用 <code>#include</code> 指令和头文件。 只需在编译程序时引用特定的程序集，即可在 C# 程序中使用此程序集中包含的公共类型和成员。 例如，此程序使用 <code>acme.dll</code> 程序集中的 <code>Acme.Collections.Stack</code> 类：</p>
<p>C#</p>
<pre class=" language-csharp"><code class="language-csharp"><span class="token keyword">using</span> System<span class="token punctuation">;</span>
<span class="token keyword">using</span> Acme<span class="token punctuation">.</span>Collections<span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">Example</span>
<span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token punctuation">{</span>
        Stack s <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stack</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        s<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        s<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        s<span class="token punctuation">.</span><span class="token function">Push</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Console<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">Pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>如果程序存储在文件 <code>example.cs</code> 中，那么在 <code>example.cs</code> 编译完后，可以使用编译器的 /r 选项引用 acme.dll 程序集：</p>
<p>复制</p>
<pre><code>csc /r:acme.dll example.cs
</code></pre><p>这会创建 <code>example.exe</code> 可执行程序集，它将在运行时输出以下内容：</p>
<p>复制</p>
<pre><code>100
10
1
</code></pre><p>使用 C#，可以将程序的源文本存储在多个源文件中。 编译多文件 C# 程序时，可以将所有源文件一起处理，并且源文件可以随意相互引用。从概念上讲，就像是所有源文件在处理前被集中到一个大文件中一样。 在 C# 中，永远都不需要使用前向声明，因为声明顺序无关紧要（除了极少数的例外情况）。 C# 并不限制源文件只能声明一种公共类型，也不要求源文件的文件名必须与其中声明的类型相匹配。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://github.com/RoWe98/2019/07/10/C#  学习笔记/" data-id="ck4jwhkox0001vo4aj5kowfiy" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C/">C#</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/">C#</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Https/">Https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/">Java</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PyQt/">PyQt</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSL证书/">SSL证书</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Windows-Terminal/">Windows Terminal</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git仓库/">git仓库</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/http/">http</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/https/">https</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ssh/">ssh</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/七牛云/">七牛云</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/二级域名/">二级域名</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/五子棋/">五子棋</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/人脸识别/">人脸识别</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/公钥/">公钥</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/单片机/">单片机</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/博客搭建/">博客搭建</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/宝塔面板/">宝塔面板</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文档/">文档</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/智慧教室-树莓派/">智慧教室 树莓派</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/机器学习/">机器学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/私钥/">私钥</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/黑苹果/">黑苹果</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/C/" style="font-size: 12.5px;">C#</a> <a href="/tags/Https/" style="font-size: 10px;">Https</a> <a href="/tags/Java/" style="font-size: 20px;">Java</a> <a href="/tags/Linux/" style="font-size: 10px;">Linux</a> <a href="/tags/PyQt/" style="font-size: 10px;">PyQt</a> <a href="/tags/Python/" style="font-size: 10px;">Python</a> <a href="/tags/SSL证书/" style="font-size: 10px;">SSL证书</a> <a href="/tags/Windows-Terminal/" style="font-size: 10px;">Windows Terminal</a> <a href="/tags/git仓库/" style="font-size: 10px;">git仓库</a> <a href="/tags/http/" style="font-size: 10px;">http</a> <a href="/tags/https/" style="font-size: 10px;">https</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/ssh/" style="font-size: 10px;">ssh</a> <a href="/tags/七牛云/" style="font-size: 10px;">七牛云</a> <a href="/tags/二级域名/" style="font-size: 10px;">二级域名</a> <a href="/tags/五子棋/" style="font-size: 17.5px;">五子棋</a> <a href="/tags/人脸识别/" style="font-size: 10px;">人脸识别</a> <a href="/tags/公钥/" style="font-size: 10px;">公钥</a> <a href="/tags/单片机/" style="font-size: 10px;">单片机</a> <a href="/tags/博客搭建/" style="font-size: 10px;">博客搭建</a> <a href="/tags/宝塔面板/" style="font-size: 10px;">宝塔面板</a> <a href="/tags/文档/" style="font-size: 10px;">文档</a> <a href="/tags/智慧教室-树莓派/" style="font-size: 10px;">智慧教室 树莓派</a> <a href="/tags/机器学习/" style="font-size: 10px;">机器学习</a> <a href="/tags/私钥/" style="font-size: 10px;">私钥</a> <a href="/tags/黑苹果/" style="font-size: 15px;">黑苹果</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/12/24/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2019/12/24/OpenCvCarReco/">基于OpenCV技术的汽车牌照的识别</a>
          </li>
        
          <li>
            <a href="/2019/12/24/How-to-make-A-image-Server/">如何搭建一个图片服务器</a>
          </li>
        
          <li>
            <a href="/2019/12/24/JavaSocket/">利用Socket编程(TCP协议)完成聊天室</a>
          </li>
        
          <li>
            <a href="/2019/12/24/Fix-Bug-Baidu-Aip/">修改百度开放平台人脸识别错误[Python]json 错误xx is not JSON serializable</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Rex Rowe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>